(()=>{var e={};e.id=368,e.ids=[368],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8644:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var a=r(482),s=r(9108),l=r(2563),n=r.n(l),o=r(8300),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);r.d(t,i);let d=["",{children:["browse",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,461)),"/workspaces/ZQLC/app/browse/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,6680)),"/workspaces/ZQLC/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"]}],c=["/workspaces/ZQLC/app/browse/page.tsx"],u="/browse/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/browse/page",pathname:"/browse",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2830:(e,t,r)=>{Promise.resolve().then(r.bind(r,3866))},3866:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(5344),s=r(3729),l=r(8428),n=r(2829);function o({onCancel:e,onCreate:t,placeholder:r="Name",codeMaxLength:l=1,codeType:n="alpha",codePlaceholder:o="C"}){let[i,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[m,p]=(0,s.useState)(!1),g=(0,s.useRef)(null);(0,s.useEffect)(()=>{g.current&&g.current.focus()},[]);let x=async()=>{if(!i.trim()||!c.trim()){alert("Please enter both code and name");return}p(!0);try{await t(i.trim(),c.trim()),d(""),u("")}catch(e){}finally{p(!1)}},h=()=>{d(""),u(""),e()},y=e=>{"Enter"===e.key&&(e.preventDefault(),x()),"Escape"===e.key&&(e.preventDefault(),h())};return a.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx("input",{type:"text",value:i,onChange:e=>{let t=e.target.value;"numeric"===n?d(t.replace(/\D/g,"").slice(0,l)):d(t.toUpperCase().slice(0,l))},onKeyDown:y,className:`${"numeric"===n?"w-16":"w-12"} px-2 py-2 font-mono bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-center focus:outline-none focus:ring-2 focus:ring-blue-500`,maxLength:l,placeholder:o,disabled:m}),a.jsx("input",{ref:g,type:"text",value:c,onChange:e=>{u(e.target.value)},onKeyDown:y,className:"flex-1 px-3 py-2 font-mono bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:r,disabled:m})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:x,disabled:m||!i.trim()||!c.trim(),className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded text-sm font-medium transition-colors",children:m?"Creating...":"Create"}),a.jsx("button",{onClick:h,disabled:m,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 text-white rounded text-sm font-medium transition-colors",children:"Cancel"})]}),i.trim()&&c.trim()&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:["Preview: ",i.toUpperCase()," - ",c]})]})})}function i({isOpen:e,onClose:t,onImportComplete:r}){let[l,o]=(0,s.useState)(null),[i,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null),[m,p]=(0,s.useState)(!1),[g,x]=(0,s.useState)(!1),[h,y]=(0,s.useState)(!1),[f,b]=(0,s.useState)(0),[v,_]=(0,s.useState)(!1),[N,j]=(0,s.useState)(null),k=(0,s.useRef)(null),w=(0,s.useCallback)(async e=>{if(!e.name.toLowerCase().endsWith(".csv")){alert("Please select a CSV file");return}o(e),u(null),p(!1),d(!0),j(null);try{let t=await C(e),r=function(e){let t=e.split("\n").filter(e=>e.trim());if(0===t.length)throw Error("CSV file is empty");let r=t[0].split(",").map(e=>e.trim().replace(/"/g,"")),a=["type","universe_code","universe_name","phylum_code","phylum_name","family_code","family_name","group_num","group_name","task_num","task_title","task_status","task_priority","base_code","id","display_order"].filter(e=>!r.includes(e));if(a.length>0)throw Error(`Missing required columns: ${a.join(", ")}`);let s=[];for(let e=1;e<t.length;e++){let a=t[e].trim();if(a)try{let t=function(e){let t=[],r="",a=!1;for(let s=0;s<e.length;s++){let l=e[s];'"'===l?a&&'"'===e[s+1]?(r+='"',s++):a=!a:","!==l||a?r+=l:(t.push(r.trim()),r="")}return t.push(r.trim()),t}(a);if(t.length!==r.length)throw Error(`Row ${e+1}: Expected ${r.length} columns, got ${t.length}`);let l={_rowIndex:e+1};if(r.forEach((e,r)=>{let a=t[r];if(["group_num","task_num","task_priority","display_order"].includes(e)){let t=parseInt(a);l[e]=isNaN(t)?a:t}else l[e]=a}),!["universe","phylum","family","group","task"].includes(l.type))throw Error(`Row ${e+1}: Invalid type '${l.type}'`);s.push(l)}catch(t){throw Error(`Row ${e+1}: ${t instanceof Error?t.message:"Parse error"}`)}}return s}(t),a=await E(),s=function(e){let t=[],r=e.filter(e=>"universe"===e.type),a=e.filter(e=>"phylum"===e.type),s=e.filter(e=>"family"===e.type),l=e.filter(e=>"group"===e.type),n=e.filter(e=>"task"===e.type),o=new Set;r.forEach(e=>{e.universe_code&&1===e.universe_code.length||t.push({type:"error",message:`Universe code must be single character: "${e.universe_code}"`,rowIndex:e._rowIndex,field:"universe_code"}),o.has(e.universe_code)?t.push({type:"error",message:`Duplicate universe code: "${e.universe_code}"`,rowIndex:e._rowIndex,field:"universe_code"}):o.add(e.universe_code),e.universe_name?.trim()||t.push({type:"error",message:"Universe name is required",rowIndex:e._rowIndex,field:"universe_name"})}),a.forEach(e=>{e.phylum_code&&1===e.phylum_code.length||t.push({type:"error",message:`Phylum code must be single character: "${e.phylum_code}"`,rowIndex:e._rowIndex,field:"phylum_code"}),o.has(e.universe_code)||t.push({type:"error",message:`Phylum references non-existent universe: "${e.universe_code}"`,rowIndex:e._rowIndex,field:"universe_code"}),e.phylum_name?.trim()||t.push({type:"error",message:"Phylum name is required",rowIndex:e._rowIndex,field:"phylum_name"})});let i=new Set(a.map(e=>`${e.universe_code}-${e.phylum_code}`));return s.forEach(e=>{e.family_code&&1===e.family_code.length||t.push({type:"error",message:`Family code must be single character: "${e.family_code}"`,rowIndex:e._rowIndex,field:"family_code"});let r=`${e.universe_code}-${e.phylum_code}`;i.has(r)||t.push({type:"error",message:`Family references non-existent phylum: "${e.universe_code}/${e.phylum_code}"`,rowIndex:e._rowIndex,field:"phylum_code"}),e.family_name?.trim()||t.push({type:"error",message:"Family name is required",rowIndex:e._rowIndex,field:"family_name"})}),l.forEach(e=>{let r="string"==typeof e.group_num?parseInt(e.group_num):e.group_num;(isNaN(r)||r<1||r>99)&&t.push({type:"error",message:`Group number must be between 1-99: "${e.group_num}"`,rowIndex:e._rowIndex,field:"group_num"}),e.group_name?.trim()||t.push({type:"error",message:"Group name is required",rowIndex:e._rowIndex,field:"group_name"})}),n.forEach(e=>{let r="string"==typeof e.task_num?parseInt(e.task_num):e.task_num;(isNaN(r)||r<1||r>99)&&t.push({type:"error",message:`Task number must be between 1-99: "${e.task_num}"`,rowIndex:e._rowIndex,field:"task_num"}),e.task_title?.trim()||t.push({type:"error",message:"Task title is required",rowIndex:e._rowIndex,field:"task_title"}),["R","P","D","F","C","X"].includes(e.task_status)||t.push({type:"error",message:`Invalid task status: "${e.task_status}". Must be R/P/D/F/C/X`,rowIndex:e._rowIndex,field:"task_status"});let a="string"==typeof e.task_priority?parseInt(e.task_priority):e.task_priority;(isNaN(a)||a<1||a>5)&&t.push({type:"error",message:`Task priority must be between 1-5: "${e.task_priority}"`,rowIndex:e._rowIndex,field:"task_priority"}),e.base_code?.match(/^[A-Z]{2,3}-\d{2}\.\d{2}$/)||t.push({type:"error",message:`Invalid base_code format: "${e.base_code}". Expected: ABC-01.01`,rowIndex:e._rowIndex,field:"base_code"})}),[...t]}(r),l=function(e,t){let r={creates:{universes:0,phyla:0,families:0,groups:0,tasks:0},updates:{universes:0,phyla:0,families:0,groups:0,tasks:0},deletes:{universes:0,phyla:0,families:0,groups:0,tasks:0}},a=e.filter(e=>"universe"===e.type),s=e.filter(e=>"phylum"===e.type),l=e.filter(e=>"family"===e.type),n=e.filter(e=>"group"===e.type),o=e.filter(e=>"task"===e.type);return a.forEach(e=>{let a=t.universes?.find(t=>t.code===e.universe_code);a?a.name!==e.universe_name&&r.updates.universes++:r.creates.universes++}),s.forEach(e=>{let a=t.phyla?.find(t=>t.universe_code===e.universe_code&&t.code===e.phylum_code);a?a.name!==e.phylum_name&&r.updates.phyla++:r.creates.phyla++}),l.forEach(e=>{let a=t.families?.find(t=>t.universe_code===e.universe_code&&t.phylum_code===e.phylum_code&&t.code===e.family_code);a?a.name!==e.family_name&&r.updates.families++:r.creates.families++}),n.forEach(e=>{let a=t.groups?.find(t=>t.universe_code===e.universe_code&&t.phylum_code===e.phylum_code&&t.family_code===e.family_code&&t.group_num===e.group_num);a?a.name!==e.group_name&&r.updates.groups++:r.creates.groups++}),o.forEach(e=>{let a=t.tasks?.find(t=>t.base_code===e.base_code);a?(a.title!==e.task_title||a.current_status!==e.task_status||a.priority!==e.task_priority)&&r.updates.tasks++:r.creates.tasks++}),r}(r,a),n=function(e,t){let r=new Set(e.filter(e=>"task"===e.type).map(e=>e.base_code));return t.filter(e=>!r.has(e.base_code)).map(e=>({id:e.id,base_code:e.base_code,title:e.title,current_status:e.current_status||e.status,universe_name:e.universe_name||"Unknown"}))}(r,a.tasks||[]),o={isValid:0===s.filter(e=>"error"===e.type).length,errors:s.filter(e=>"error"===e.type),warnings:s.filter(e=>"warning"===e.type),changes:l,tasksToDelete:n,parsedData:r};u(o)}catch(e){j(e instanceof Error?e.message:"Failed to process CSV file")}finally{d(!1)}},[]),C=e=>new Promise((t,r)=>{let a=new FileReader;a.onload=e=>t(e.target?.result),a.onerror=()=>r(Error("Failed to read file")),a.readAsText(e)}),E=async()=>{let[{data:e},{data:t},{data:r},{data:a},{data:s}]=await Promise.all([n.O.from("universes").select("*"),n.O.from("phyla").select("*, universe:universes(code, name)"),n.O.from("families").select("*, phylum:phyla(code, name, universe:universes(code, name))"),n.O.from("groups_with_counts").select("*"),n.O.from("task_details").select("*")]);return{universes:e,phyla:t,families:r,groups:a,tasks:s}},S=async()=>{if(c&&c.isValid){y(!0),b(0),j(null);try{if(c.tasksToDelete.length>0&&!m){j("Please confirm deletion of existing tasks before proceeding"),y(!1);return}b(50);let{error:e}=await n.O.rpc("bulk_import_system_data",{import_data:c.parsedData,delete_missing_tasks:m});if(e)throw Error(e.message);b(100),_(!0),setTimeout(()=>{r?.(),t(),I()},2e3)}catch(e){j(e instanceof Error?e.message:"Import failed")}finally{y(!1)}}},I=()=>{o(null),u(null),p(!1),x(!1),y(!1),b(0),_(!1),j(null),d(!1)},T=()=>{h||(I(),t())};return e?a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-2 sm:p-4",children:(0,a.jsxs)("div",{className:"bg-black text-green-400 font-mono rounded-lg w-full max-w-4xl max-h-[95vh] flex flex-col border-2 border-green-400",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-green-400 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),a.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),a.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),a.jsx("span",{className:"ml-4 text-green-400",children:"SYSTEM DATA IMPORT - TERMINAL"})]}),a.jsx("button",{onClick:T,disabled:h,className:"text-green-400 hover:text-green-300 disabled:opacity-50",children:"[\xd7]"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[!l&&(0,a.jsxs)("div",{className:"border-2 border-dashed border-green-400 p-8 text-center cursor-pointer hover:border-green-300 transition-colors",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation();let t=Array.from(e.dataTransfer.files);t.length>0&&w(t[0])},onClick:()=>k.current?.click(),children:[a.jsx("div",{className:"text-lg mb-2",children:"> DRAG CSV FILE HERE OR [BROWSE FILE]"}),a.jsx("div",{className:"text-sm text-green-300",children:"Expected format: ATOL system export CSV"}),a.jsx("input",{ref:k,type:"file",accept:".csv",onChange:e=>e.target.files?.[0]&&w(e.target.files[0]),className:"hidden"})]}),l&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:["> FILE LOADED: ",l.name," (",(l.size/1024/1024).toFixed(2),"MB)"]}),i&&a.jsx("div",{children:"> PARSING AND VALIDATING..."}),c&&!i&&(0,a.jsxs)("div",{children:["> PARSING COMPLETE: ",c.parsedData.length," RECORDS DETECTED"]})]}),c&&!i&&(0,a.jsxs)("div",{className:"border border-green-400 p-4 space-y-2",children:[a.jsx("div",{className:"text-yellow-400",children:"─ VALIDATION RESULTS ─────────────────────────"}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-green-400",children:"✓ CSV FORMAT: VALID"}),a.jsx("div",{className:"text-green-400",children:"✓ REQUIRED COLUMNS: FOUND"}),c.errors.length>0&&(0,a.jsxs)("div",{className:"text-red-400",children:["✗ ERRORS: ",c.errors.length," FOUND",(0,a.jsxs)("div",{className:"ml-4 text-sm space-y-1",children:[c.errors.slice(0,5).map((e,t)=>(0,a.jsxs)("div",{children:["- Row ",e.rowIndex,": ",e.message]},t)),c.errors.length>5&&(0,a.jsxs)("div",{children:["- (",c.errors.length-5," more errors...)"]})]})]}),c.warnings.length>0&&(0,a.jsxs)("div",{className:"text-yellow-400",children:["⚠ WARNINGS: ",c.warnings.length," FOUND"]})]}),c.isValid&&(0,a.jsxs)("div",{className:"mt-4 space-y-1",children:[a.jsx("div",{className:"text-yellow-400",children:"CHANGES PREVIEW:"}),(0,a.jsxs)("div",{className:"ml-2 space-y-1",children:[c.changes.creates.universes>0&&(0,a.jsxs)("div",{children:["• ",c.changes.creates.universes," NEW UNIVERSES"]}),c.changes.creates.phyla>0&&(0,a.jsxs)("div",{children:["• ",c.changes.creates.phyla," NEW PHYLA"]}),c.changes.creates.families>0&&(0,a.jsxs)("div",{children:["• ",c.changes.creates.families," NEW FAMILIES"]}),c.changes.creates.groups>0&&(0,a.jsxs)("div",{children:["• ",c.changes.creates.groups," NEW GROUPS"]}),c.changes.creates.tasks>0&&(0,a.jsxs)("div",{children:["• ",c.changes.creates.tasks," NEW TASKS"]}),c.changes.updates.universes>0&&(0,a.jsxs)("div",{children:["• ",c.changes.updates.universes," UPDATED UNIVERSES"]}),c.changes.updates.phyla>0&&(0,a.jsxs)("div",{children:["• ",c.changes.updates.phyla," UPDATED PHYLA"]}),c.changes.updates.families>0&&(0,a.jsxs)("div",{children:["• ",c.changes.updates.families," UPDATED FAMILIES"]}),c.changes.updates.groups>0&&(0,a.jsxs)("div",{children:["• ",c.changes.updates.groups," UPDATED GROUPS"]}),c.changes.updates.tasks>0&&(0,a.jsxs)("div",{children:["• ",c.changes.updates.tasks," UPDATED TASKS"]})]}),c.tasksToDelete.length>0&&(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[a.jsx("div",{className:"text-red-400",children:"⚠️ DELETION DETECTED:"}),(0,a.jsxs)("div",{className:"ml-2",children:[(0,a.jsxs)("div",{className:"text-red-400",children:["• ",c.tasksToDelete.length," TASKS IN DATABASE NOT IN IMPORT FILE"]}),g?a.jsx("div",{className:"ml-4 text-sm space-y-1 max-h-32 overflow-y-auto",children:c.tasksToDelete.map((e,t)=>(0,a.jsxs)("div",{children:["- ",e.base_code,' "',e.title,'" (',e.current_status,")"]},t))}):(0,a.jsxs)("div",{className:"ml-4 text-sm space-y-1",children:[c.tasksToDelete.slice(0,3).map((e,t)=>(0,a.jsxs)("div",{children:["- ",e.base_code,' "',e.title,'"']},t)),c.tasksToDelete.length>3&&(0,a.jsxs)("button",{onClick:()=>x(!0),className:"text-yellow-400 hover:text-yellow-300 underline",children:["(",c.tasksToDelete.length-3," more tasks - click to expand)"]})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:"confirmDelete",checked:m,onChange:e=>p(e.target.checked),className:"rounded"}),(0,a.jsxs)("label",{htmlFor:"confirmDelete",className:"text-red-400",children:["☐ CONFIRM DELETION OF ",c.tasksToDelete.length," TASKS"]})]})]})]})]})]}),h&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("div",{children:"> IMPORTING DATA..."}),a.jsx("div",{className:"bg-green-900 w-full h-4 rounded",children:a.jsx("div",{className:"bg-green-400 h-full rounded transition-all duration-300",style:{width:`${f}%`}})}),(0,a.jsxs)("div",{children:["> PROGRESS: ",f,"%"]})]}),v&&(0,a.jsxs)("div",{className:"text-green-400 space-y-1",children:[a.jsx("div",{children:"> IMPORT COMPLETE ✓"}),a.jsx("div",{children:"> SYSTEM DATA UPDATED SUCCESSFULLY"}),a.jsx("div",{children:"> CLOSING TERMINAL..."})]}),N&&a.jsx("div",{className:"text-red-400",children:(0,a.jsxs)("div",{children:["> ERROR: ",N]})})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-green-400 flex flex-wrap gap-2 justify-between",children:[(0,a.jsxs)("div",{className:"text-xs text-green-300",children:["⚠️ WARNING: THIS WILL MODIFY SYSTEM DATA",a.jsx("br",{}),"⚠️ BACKUP RECOMMENDED BEFORE PROCEEDING"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:T,disabled:h,className:"px-4 py-2 border border-green-400 text-green-400 hover:bg-green-400 hover:text-black transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"[CANCEL]"}),c?.tasksToDelete.length>0&&a.jsx("button",{onClick:()=>x(!g),className:"px-4 py-2 border border-yellow-400 text-yellow-400 hover:bg-yellow-400 hover:text-black transition-colors",children:"[PREVIEW DELETIONS]"}),a.jsx("button",{onClick:S,disabled:!c?.isValid||h||c?.tasksToDelete.length>0&&!m,className:"px-4 py-2 border border-green-400 text-green-400 hover:bg-green-400 hover:text-black transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?"[IMPORTING...]":"[IMPORT]"})]})]})]})}):null}function d(){let e=(0,l.useRouter)(),[t,r]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)("UNI"),[p,g]=(0,s.useState)([]),[x,h]=(0,s.useState)([]),[y,f]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),[_,N]=(0,s.useState)([]),[j,k]=(0,s.useState)(null),[w,C]=(0,s.useState)(null),[E,S]=(0,s.useState)(null),[I,T]=(0,s.useState)(null),[P,A]=(0,s.useState)(!1),[$,D]=(0,s.useState)(!1),[O,R]=(0,s.useState)(!1),[L,F]=(0,s.useState)(!1),[U,q]=(0,s.useState)(!1),[M,G]=(0,s.useState)(""),[V,W]=(0,s.useState)(""),[Y,K]=(0,s.useState)(""),[B,H]=(0,s.useState)(""),[z,Q]=(0,s.useState)(""),[Z,X]=(0,s.useState)(""),[J,ee]=(0,s.useState)(""),[et,er]=(0,s.useState)(""),[ea,es]=(0,s.useState)(""),[el,en]=(0,s.useState)(""),[eo,ei]=(0,s.useState)(null),[ed,ec]=(0,s.useState)(null),[eu,em]=(0,s.useState)(""),[ep,eg]=(0,s.useState)(""),[ex,eh]=(0,s.useState)(""),[ey,ef]=(0,s.useState)(!1),eb=(0,s.useCallback)(()=>{ev(),j&&e_(),w&&eN(),w&&ej(),I&&ek()},[ev,e_,eN,ej,ek,j,w,I]),ev=(0,s.useCallback)(async()=>{try{let{data:e,error:t}=await n.O.from("universes").select("*").order("display_order");t?console.error("Error in loadUniverses:",t):g(e||[])}catch(e){console.error("Exception in loadUniverses:",e)}},[]),e_=(0,s.useCallback)(async()=>{if(j)try{let{data:e}=await n.O.from("phyla").select("*").eq("universe_id",j.id).order("display_order");h(e||[])}catch(e){console.error("Error loading phylums:",e)}},[j]),eN=(0,s.useCallback)(async()=>{if(w)try{let{data:e}=await n.O.from("families").select("*").eq("phylum_id",w.id).order("display_order");f(e||[])}catch(e){console.error("Error loading families:",e)}},[w]),ej=(0,s.useCallback)(async()=>{if(w&&j)try{let e=n.O.from("groups_with_counts").select("*").eq("universe_id",j.id).eq("phylum_id",w.id);E?e.eq("family_id",E.id):e.is("family_id",null);let{data:t}=await e.order("group_num");v(t||[])}catch(e){console.error("Error loading groups:",e)}},[w,j,E]),ek=(0,s.useCallback)(async()=>{if(w&&j&&I)try{let e=n.O.from("task_details").select("*").eq("universe_id",j.id).eq("phylum_id",w.id).eq("group_num",I.group_num);E&&e.eq("family_id",E.id);let{data:t}=await e.order("task_num");N(t||[])}catch(e){console.error("Error loading tasks:",e)}},[w,j,I,E]);if((0,s.useEffect)(()=>{r(!0);let e=()=>c(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{t&&ev()},[t]),(0,s.useEffect)(()=>{t&&j&&(e_(),d&&m("PHY"))},[j,t,d]),(0,s.useEffect)(()=>{t&&w&&(eN(),ej(),d&&m("FAM"))},[w,t,d]),(0,s.useEffect)(()=>{t&&w&&I&&(ek(),d&&m("TSK"))},[I,t,w,d]),!t)return a.jsx("div",{className:"min-h-screen bg-[#F8F7F4] dark:bg-[#0A0A0B] flex items-center justify-center",children:a.jsx("div",{className:"text-gray-500 font-mono",children:"Loading..."})});async function ew(e,t){let r=e||M,a=t||V;if(!r?.trim()||!a?.trim()){alert("Please enter both a code and name");return}let s=r.trim().toUpperCase().slice(0,1),l=p.find(e=>e.code===s);if(l){alert(`A universe with code "${s}" already exists: ${l.name}`);return}try{let{data:e,error:t}=await n.O.from("universes").insert({code:s,name:a.trim(),color:"#"+Math.floor(16777215*Math.random()).toString(16),display_order:p.length+1}).select().single();if(t){console.error("Supabase error:",t),alert(`Error creating universe: ${t.message}`);return}e&&(g(t=>[...t,e]),A(!1),G(""),W(""),await ev())}catch(e){console.error("Exception in createUniverse:",e),alert(`Failed to create universe: ${e?.message||e}`)}}async function eC(e,t){let r=e||Y,a=t||B;if(!r?.trim()||!a?.trim()||!j){alert("Please enter both a code and name");return}let s=r.trim().toUpperCase().slice(0,1),l=x.find(e=>e.code===s);if(l){alert(`A phylum with code "${s}" already exists: ${l.name}`);return}try{let{data:e,error:t}=await n.O.from("phyla").insert({universe_id:j.id,code:s,name:a.trim()}).select().single();if(t){alert(`Error creating phylum: ${t.message}`);return}e&&(h(t=>[...t,e]),D(!1),K(""),H(""),await e_())}catch(e){console.error("Error creating phylum:",e),alert(`Failed to create phylum: ${e?.message||e}`)}}async function eE(e,t){let r=e||z,a=t||Z;if(!r?.trim()||!a?.trim()||!w){alert("Please enter both a code and name");return}let s=r.trim().toUpperCase().slice(0,1),l=y.find(e=>e.code===s);if(l){alert(`A family with code "${s}" already exists: ${l.name}`);return}try{let{data:e,error:t}=await n.O.from("families").insert({phylum_id:w.id,code:s,name:a.trim()}).select().single();if(t){alert(`Error creating family: ${t.message}`);return}e&&(f(t=>[...t,e]),R(!1),Q(""),X(""),await eN())}catch(e){console.error("Error creating family:",e),alert(`Failed to create family: ${e?.message||e}`)}}async function eS(e,t){let r=e||et,a=t||J;if(!r?.trim()||!a?.trim()||!w||!j){alert("Please enter both a group number and name");return}let s=parseInt(r.trim());if(isNaN(s)||s<1||s>99){alert("Group number must be between 1 and 99");return}let l=b.find(e=>e.group_num===s);if(l){alert(`A group with number "${s}" already exists: ${l.name}`);return}try{let{data:e,error:t}=await n.O.from("groups").insert({universe_id:j.id,phylum_id:w.id,family_id:E?.id||null,group_num:s,name:a.trim()}).select().single();if(t){alert(`Error creating group: ${t.message}`);return}e&&(F(!1),er(""),ee(""),await ej())}catch(e){console.error("Error creating group:",e),alert(`Failed to create group: ${e?.message||e}`)}}async function eI(){if(!ea||!el||!I||!w||!j)return;let e=new Date,t=e.toISOString().replace("T","_").replace(/[-:]/g,".").substring(0,16),r=`${j.code}${w.code}${E?.code||""}-${String(I.group_num).padStart(2,"0")}.${el.padStart(2,"0")}`.toUpperCase(),a=`R-${t}=${r}`;try{let{data:t,error:s}=await n.O.from("tasks").insert({code:a,base_code:r,title:ea,universe_id:j.id,phylum_id:w.id,family_id:E?.id||null,group_num:I.group_num,task_num:parseInt(el),priority:3,status:"active",task_timestamp:e.toISOString()}).select().single();if(s)throw s;t&&(await n.O.rpc("create_task_entry",{p_task_id:t.id,p_status_code:"R",p_note:"Initial entry",p_entry_timestamp:e.toISOString()}),ek(),q(!1),es(""),en(""))}catch(e){console.error("Error creating task:",e)}}async function eT(e,t,r){try{let{error:a}=await n.O.from("universes").update({code:t.toUpperCase().slice(0,1),name:r}).eq("id",e);if(a)throw a;g(p.map(a=>a.id===e?{...a,code:t.toUpperCase().slice(0,1),name:r}:a)),ei(null),ec(null),em(""),eg("")}catch(e){console.error("Error updating universe:",e),alert("Failed to update universe")}}async function eP(e,t,r){try{let{error:a}=await n.O.from("phyla").update({code:t.toUpperCase().slice(0,1),name:r}).eq("id",e);if(a)throw a;h(x.map(a=>a.id===e?{...a,code:t.toUpperCase().slice(0,1),name:r}:a)),ei(null),ec(null),em(""),eg("")}catch(e){console.error("Error updating phylum:",e),alert("Failed to update phylum")}}async function eA(e,t,r){try{let{error:a}=await n.O.from("families").update({code:t.toUpperCase().slice(0,1),name:r}).eq("id",e);if(a)throw a;f(y.map(a=>a.id===e?{...a,code:t.toUpperCase().slice(0,1),name:r}:a)),ei(null),ec(null),em(""),eg("")}catch(e){console.error("Error updating family:",e),alert("Failed to update family")}}async function e$(e,t){try{let{error:r}=await n.O.from("groups").update({name:t}).eq("id",e);if(r)throw r;v(b.map(r=>r.id===e?{...r,name:t}:r)),ei(null),ec(null),em(""),eg("")}catch(e){console.error("Error updating group:",e),alert("Failed to update group")}}async function eD(e,t){if(confirm(`Are you sure you want to delete the universe "${t}"? This will also delete all associated phyla, families, groups, and tasks. This action cannot be undone.`))try{let{error:t}=await n.O.from("universes").delete().eq("id",e);if(t)throw t;g(p.filter(t=>t.id!==e)),j?.id===e&&(k(null),C(null),S(null),T(null))}catch(e){console.error("Error deleting universe:",e),alert("Failed to delete universe")}}async function eO(e,t){if(confirm(`Are you sure you want to delete the phylum "${t}"? This will also delete all associated families, groups, and tasks. This action cannot be undone.`))try{let{error:t}=await n.O.from("phyla").delete().eq("id",e);if(t)throw t;h(x.filter(t=>t.id!==e)),w?.id===e&&(C(null),S(null),T(null))}catch(e){console.error("Error deleting phylum:",e),alert("Failed to delete phylum")}}async function eR(e,t){if(confirm(`Are you sure you want to delete the family "${t}"? This will also delete all associated groups and tasks. This action cannot be undone.`))try{let{error:t}=await n.O.from("families").delete().eq("id",e);if(t)throw t;f(y.filter(t=>t.id!==e)),E?.id===e&&(S(null),T(null))}catch(e){console.error("Error deleting family:",e),alert("Failed to delete family")}}async function eL(e,t){if(confirm(`Are you sure you want to delete the group "${t}"? This will also delete all associated tasks. This action cannot be undone.`))try{let{error:t}=await n.O.from("groups").delete().eq("id",e);if(t)throw t;v(b.filter(t=>t.id!==e)),I?.id===e&&T(null)}catch(e){console.error("Error deleting group:",e),alert("Failed to delete group")}}let eF=(e,t,r,a)=>{ei(e),ec(t),eg(r),em(a)},eU=()=>{ei(null),ec(null),em(""),eg(""),eh("")},eq=async()=>{if(eo&&ed){if(eh(""),!eu.trim()){eh("Name is required");return}if("group"!==eo&&!ep.trim()){eh("Code is required");return}if("group"!==eo&&(()=>{switch(eo){case"universe":return p.some(e=>e.id!==ed&&e.code.toLowerCase()===ep.toLowerCase());case"phylum":return x.some(e=>e.id!==ed&&e.code.toLowerCase()===ep.toLowerCase());case"family":return y.some(e=>e.id!==ed&&e.code.toLowerCase()===ep.toLowerCase());default:return!1}})()){eh(`Code "${ep}" already exists`);return}switch(eo){case"universe":await eT(ed,ep,eu);break;case"phylum":await eP(ed,ep,eu);break;case"family":await eA(ed,ep,eu);break;case"group":await e$(ed,eu)}}};async function eM(){try{let{data:e}=await n.O.from("task_details").select("*").order("universe_code, phylum_code, family_code, group_num, task_num"),{data:t}=await n.O.from("universes").select("*").order("display_order"),{data:r}=await n.O.from("phyla").select("*, universe:universes(code, name)").order("display_order"),{data:a}=await n.O.from("families").select("*, phylum:phyla(code, name, universe:universes(code, name))").order("display_order"),{data:s}=await n.O.from("groups_with_counts").select("*").order("group_num"),l=[],o=new Set;t?.forEach(e=>{let t=`universe-${e.code}`;o.has(t)||(l.push({type:"universe",universe_code:e.code,universe_name:e.name,phylum_code:"",phylum_name:"",family_code:"",family_name:"",group_num:"",group_name:"",task_num:"",task_title:"",task_status:"",task_priority:"",base_code:"",id:e.id,display_order:e.display_order||0}),o.add(t))}),r?.forEach(e=>{let t=`phylum-${e.universe?.code}-${e.code}`;o.has(t)||(l.push({type:"phylum",universe_code:e.universe?.code||"",universe_name:e.universe?.name||"",phylum_code:e.code,phylum_name:e.name,family_code:"",family_name:"",group_num:"",group_name:"",task_num:"",task_title:"",task_status:"",task_priority:"",base_code:"",id:e.id,display_order:e.display_order||0}),o.add(t))}),a?.forEach(e=>{let t=e.phylum?.universe?.code||"",r=e.phylum?.code||"",a=`family-${t}-${r}-${e.code}`;o.has(a)||(l.push({type:"family",universe_code:t,universe_name:e.phylum?.universe?.name||"",phylum_code:r,phylum_name:e.phylum?.name||"",family_code:e.code,family_name:e.name,group_num:"",group_name:"",task_num:"",task_title:"",task_status:"",task_priority:"",base_code:"",id:e.id,display_order:e.display_order||0}),o.add(a))}),s?.forEach(e=>{let s=t?.find(t=>t.id===e.universe_id),n=r?.find(t=>t.id===e.phylum_id),i=a?.find(t=>t.id===e.family_id),d=`group-${s?.code}-${n?.code}-${i?.code||"null"}-${e.group_num}`;o.has(d)||(l.push({type:"group",universe_code:s?.code||"",universe_name:s?.name||"",phylum_code:n?.code||"",phylum_name:n?.name||"",family_code:i?.code||"",family_name:i?.name||"",group_num:e.group_num,group_name:e.name||"",task_num:"",task_title:"",task_status:"",task_priority:"",base_code:"",id:e.id,display_order:0}),o.add(d))}),e?.forEach(e=>{l.push({type:"task",universe_code:e.universe_code||"",universe_name:e.universe_name||"",phylum_code:e.phylum_code||"",phylum_name:e.phylum_name||"",family_code:e.family_code||"",family_name:e.family_name||"",group_num:e.group_num,group_name:e.group_name||"",task_num:e.task_num,task_title:e.title,task_status:e.current_status||e.status,task_priority:e.priority,base_code:e.base_code,id:e.id,display_order:0})});let i=["type","universe_code","universe_name","phylum_code","phylum_name","family_code","family_name","group_num","group_name","task_num","task_title","task_status","task_priority","base_code","id","display_order"],d=[i.join(",")];l.forEach(e=>{let t=i.map(t=>{let r=e[t]||"";return"string"==typeof r&&(r.includes(",")||r.includes('"'))?`"${r.replace(/"/g,'""')}"`:r});d.push(t.join(","))});let c=d.join("\n"),u=new Blob([c],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),p=new Date().toISOString().split("T")[0],g=`atol-system-export-${p}.csv`;m.href=URL.createObjectURL(u),m.download=g,m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),alert(`System data exported successfully!
File: ${g}
Records: ${l.length}`)}catch(e){console.error("Export error:",e),alert("Failed to export system data. Please check the console for details.")}}function eG(){ef(!0)}let eV=({title:e,color:t,children:r})=>(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full border-r border-gray-300 dark:border-gray-700 last:border-r-0",children:[a.jsx("div",{className:`p-4 border-b border-gray-300 dark:border-gray-700 ${t}`,children:a.jsx("h2",{className:"font-mono font-bold text-sm",children:e})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:r})]});return d?(0,a.jsxs)("div",{className:"min-h-screen bg-[#F8F7F4] dark:bg-[#0A0A0B]",children:[a.jsx("div",{className:"flex border-b-2 border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900",children:["UNI","PHY","FAM","GRP","TSK"].map(e=>a.jsx("button",{onClick:()=>m(e),className:`flex-1 p-3 font-mono font-bold text-sm ${u===e?"bg-yellow-100 dark:bg-yellow-900/20 border-b-2 border-yellow-500":"text-gray-500"}`,children:e},e))}),(0,a.jsxs)("div",{className:"p-4",children:["UNI"===u&&(0,a.jsxs)("div",{className:"space-y-2",children:[p.map(e=>a.jsx("div",{className:"relative",children:"universe"===eo&&ed===e.id?(0,a.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),a.jsx("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Name"})]}),ex&&a.jsx("div",{className:"text-red-600 text-xs",children:ex}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eq,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Save"}),a.jsx("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:`p-4 rounded-lg font-mono ${j?.id===e.id?"bg-yellow-100 dark:bg-yellow-900/20 ring-2 ring-yellow-500":"bg-white dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[(0,a.jsxs)("div",{onClick:()=>k(e),className:"cursor-pointer",children:[a.jsx("span",{className:"text-xl font-bold",children:e.code}),a.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:e.name}),a.jsx("div",{className:"mt-1 h-2 bg-gray-200 dark:bg-gray-700 rounded",children:a.jsx("div",{className:"h-full bg-yellow-500 rounded",style:{width:"60%"}})})]}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),eF("universe",e.id,e.code,e.name)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),eD(e.id,e.name)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),a.jsx("button",{onClick:()=>A(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]}),"PHY"===u&&j&&(0,a.jsxs)("div",{className:"space-y-2",children:[x.map(e=>a.jsx("div",{className:"relative",children:"phylum"===eo&&ed===e.id?(0,a.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),a.jsx("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Name"})]}),ex&&a.jsx("div",{className:"text-red-600 text-xs",children:ex}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eq,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Save"}),a.jsx("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:`p-4 rounded-lg font-mono ${w?.id===e.id?"bg-yellow-100 dark:bg-yellow-900/20 ring-2 ring-yellow-500":"bg-white dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[(0,a.jsxs)("div",{onClick:()=>C(e),className:"cursor-pointer",children:[a.jsx("span",{className:"text-xl font-bold",children:e.code}),a.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:e.name})]}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),eF("phylum",e.id,e.code,e.name)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),eO(e.id,e.name)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),a.jsx("button",{onClick:()=>D(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]}),"FAM"===u&&w&&(0,a.jsxs)("div",{className:"space-y-2",children:[y.map(e=>a.jsx("div",{className:"relative",children:"family"===eo&&ed===e.id?(0,a.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),a.jsx("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Name"})]}),ex&&a.jsx("div",{className:"text-red-600 text-xs",children:ex}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eq,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Save"}),a.jsx("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:`p-4 rounded-lg font-mono ${E?.id===e.id?"bg-yellow-100 dark:bg-yellow-900/20 ring-2 ring-yellow-500":"bg-white dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[(0,a.jsxs)("div",{onClick:()=>S(e),className:"cursor-pointer",children:[a.jsx("span",{className:"text-xl font-bold",children:e.code}),a.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:e.name})]}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),eF("family",e.id,e.code,e.name)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),eR(e.id,e.name)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),a.jsx("button",{onClick:()=>R(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]}),"GRP"===u&&w&&(0,a.jsxs)("div",{className:"space-y-2",children:[b.map(e=>a.jsx("div",{className:"relative",children:"group"===eo&&ed===e.id?(0,a.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[a.jsx("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"w-full px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Group name"}),ex&&a.jsx("div",{className:"text-red-600 text-xs",children:ex}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eq,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Save"}),a.jsx("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:`p-4 rounded-lg font-mono ${I?.group_num===e.group_num?"bg-yellow-100 dark:bg-yellow-900/20 ring-2 ring-yellow-500":"bg-white dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[(0,a.jsxs)("div",{onClick:()=>T(e),className:"cursor-pointer",children:[a.jsx("div",{className:"font-bold",children:String(e.group_num).padStart(2,"0")}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.name}),void 0!==e.task_count&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.task_count," tasks"]})]}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),eF("group",e.id||String(e.group_num),"",e.name)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),eL(e.id||"",e.name)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.group_num)),a.jsx("button",{onClick:()=>F(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]}),"TSK"===u&&I&&(0,a.jsxs)("div",{className:"space-y-2",children:[_.map(e=>(0,a.jsxs)("div",{onClick:()=>window.location.href=`/t/${e.code}`,className:"p-4 bg-white dark:bg-gray-900 rounded-lg font-mono hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer",children:[a.jsx("div",{className:"font-bold text-lg",children:e.code}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.title}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Status: ",e.status," | Priority: ",e.priority," | Group: ",String(e.group_num).padStart(2,"0")]})]},e.id)),U?(0,a.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:el,onChange:e=>en(e.target.value.replace(/\D/g,"").slice(0,2)),className:"w-16 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded text-center",maxLength:2,placeholder:"##"}),a.jsx("input",{type:"text",value:ea,onChange:e=>es(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Task title"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eI,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Create"}),a.jsx("button",{onClick:()=>{q(!1),es(""),en("")},className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):a.jsx("button",{onClick:()=>q(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]})]}),a.jsx("div",{className:"mt-4 p-3 bg-gray-100 dark:bg-gray-800 border-t-2 border-gray-300 dark:border-gray-700 rounded-b-lg",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-2 sm:gap-4 font-mono",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:eM,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded transition-colors text-sm",children:"[SAVE]"}),a.jsx("span",{className:"text-xs text-gray-500",children:"Export CSV"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:eG,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded transition-colors text-sm",children:"[LOAD]"}),a.jsx("span",{className:"text-xs text-gray-500",children:"Import CSV"})]})]})}),a.jsx(i,{isOpen:ey,onClose:()=>ef(!1),onImportComplete:eb})]}):(0,a.jsxs)("div",{className:"h-screen flex flex-col bg-[#F8F7F4] dark:bg-[#0A0A0B]",children:[(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsxs)(eV,{title:"UNIVERSE",color:"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400",children:[p.map(e=>a.jsx("div",{className:`p-4 border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 ${j?.id===e.id?"bg-yellow-100 dark:bg-yellow-900/20":""}`,children:"universe"===eo&&ed===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),a.jsx("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",placeholder:"Name"})]}),ex&&a.jsx("div",{className:"text-red-600 text-xs",children:ex}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eq,className:"px-3 py-1 bg-green-600 text-white rounded text-xs",children:"Save"}),a.jsx("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-xs",children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:"group relative",children:[(0,a.jsxs)("div",{onClick:()=>k(e),className:"cursor-pointer font-mono",children:[a.jsx("span",{className:"text-xl font-bold",children:e.code}),(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["(",e.name,")"]})]}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 flex gap-1 transition-opacity",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),eF("universe",e.id,e.code,e.name)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),eD(e.id,e.name)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]}),j?.id===e.id&&a.jsx("div",{className:"mt-2 h-1 bg-gradient-to-r from-yellow-400 to-yellow-500"})]})},e.id)),P?a.jsx(o,{placeholder:"Universe Name",codeMaxLength:1,onCancel:()=>{A(!1),G(""),W("")},onCreate:async(e,t)=>{await ew(e,t)}}):a.jsx("button",{onClick:()=>A(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}),a.jsx(eV,{title:"PHYLUM",color:"bg-orange-100 dark:bg-orange-900/20 text-orange-700 dark:text-orange-400",children:j?(0,a.jsxs)(a.Fragment,{children:[x.map(e=>a.jsx("div",{className:`p-4 border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 ${w?.id===e.id?"bg-yellow-100 dark:bg-yellow-900/20":""}`,children:"phylum"===eo&&ed===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),a.jsx("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",placeholder:"Name"})]}),ex&&a.jsx("div",{className:"text-red-600 text-xs",children:ex}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eq,className:"px-3 py-1 bg-green-600 text-white rounded text-xs",children:"Save"}),a.jsx("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-xs",children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:"group relative",children:[(0,a.jsxs)("div",{onClick:()=>C(e),className:"cursor-pointer font-mono",children:[a.jsx("span",{className:"text-xl font-bold",children:e.code}),(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["(",e.name,")"]})]}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 flex gap-1 transition-opacity",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),eF("phylum",e.id,e.code,e.name)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),eO(e.id,e.name)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),$?a.jsx(o,{placeholder:"Phylum Name",codeMaxLength:1,onCancel:()=>{D(!1),K(""),H("")},onCreate:async(e,t)=>{await eC(e,t)}}):a.jsx("button",{onClick:()=>D(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}):a.jsx("div",{className:"p-4 text-gray-400 text-center font-mono",children:"Select a Universe"})}),a.jsx(eV,{title:"FAMILY",color:"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400",children:w?(0,a.jsxs)(a.Fragment,{children:[y.map(e=>a.jsx("div",{className:`p-4 border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 ${E?.id===e.id?"bg-yellow-100 dark:bg-yellow-900/20":""}`,children:"family"===eo&&ed===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),a.jsx("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",placeholder:"Name"})]}),ex&&a.jsx("div",{className:"text-red-600 text-xs",children:ex}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eq,className:"px-3 py-1 bg-green-600 text-white rounded text-xs",children:"Save"}),a.jsx("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-xs",children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:"group relative",children:[(0,a.jsxs)("div",{onClick:()=>S(e),className:"cursor-pointer font-mono",children:[a.jsx("span",{className:"text-lg font-bold",children:e.code}),(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["(",e.name,")"]})]}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 flex gap-1 transition-opacity",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),eF("family",e.id,e.code,e.name)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),eR(e.id,e.name)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),O?a.jsx(o,{placeholder:"Family Name",codeMaxLength:1,onCancel:()=>{R(!1),Q(""),X("")},onCreate:async(e,t)=>{await eE(e,t)}}):a.jsx("button",{onClick:()=>R(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}):a.jsx("div",{className:"p-4 text-gray-400 text-center font-mono",children:"Select a Phylum"})}),a.jsx(eV,{title:"GROUP",color:"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400",children:w?(0,a.jsxs)(a.Fragment,{children:[b.map(e=>a.jsx("div",{className:`p-4 border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 ${I?.group_num===e.group_num?"bg-yellow-100 dark:bg-yellow-900/20":""}`,children:"group"===eo&&ed===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"w-full px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",placeholder:"Group name"}),ex&&a.jsx("div",{className:"text-red-600 text-xs",children:ex}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eq,className:"px-3 py-1 bg-green-600 text-white rounded text-xs",children:"Save"}),a.jsx("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-xs",children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:"group relative",children:[(0,a.jsxs)("div",{onClick:()=>T(e),className:"cursor-pointer font-mono",children:[a.jsx("span",{className:"font-bold",children:String(e.group_num).padStart(2,"0")}),(0,a.jsxs)("span",{className:"ml-2 text-sm",children:["- ",e.name]})]}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 flex gap-1 transition-opacity",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),eF("group",e.id||String(e.group_num),"",e.name)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),a.jsx("button",{onClick:t=>{t.stopPropagation(),eL(e.id||"",e.name)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]}),void 0!==e.task_count&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.task_count," tasks"]})]})},`${e.group_num}`)),L?a.jsx(o,{placeholder:"Group Name",codeMaxLength:2,codeType:"numeric",codePlaceholder:"01",onCancel:()=>{F(!1),er(""),ee("")},onCreate:async(e,t)=>{await eS(e,t)}}):a.jsx("button",{onClick:()=>F(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}):a.jsx("div",{className:"p-4 text-gray-400 text-center font-mono",children:"Select a Phylum"})}),a.jsx(eV,{title:"TASK",color:"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400",children:I?(0,a.jsxs)(a.Fragment,{children:[_.map(t=>a.jsx("div",{onClick:()=>e.push(`/t/${t.base_code?.toLowerCase()}`),className:"p-4 cursor-pointer border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,a.jsxs)("div",{className:"font-mono",children:[(0,a.jsxs)("div",{className:"font-bold",children:[String(t.task_num).padStart(2,"0")," ..."]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:['"',t.title,'"']}),t.current_status&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Status: ",t.current_status_name]})]})},t.id)),U?(0,a.jsxs)("div",{className:"p-4 bg-gray-100 dark:bg-gray-800",children:[a.jsx("input",{type:"text",placeholder:"Task Number",value:el,onChange:e=>en(e.target.value.replace(/\D/g,"").slice(0,2)),className:"w-full mb-2 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",maxLength:2}),a.jsx("input",{type:"text",placeholder:"Task Title",value:ea,onChange:e=>es(e.target.value),className:"w-full mb-2 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:eI,className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Create"}),a.jsx("button",{onClick:()=>{q(!1),es(""),en("")},className:"px-3 py-1 bg-gray-400 text-white rounded",children:"Cancel"})]})]}):a.jsx("button",{onClick:()=>q(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}):a.jsx("div",{className:"p-4 text-gray-400 text-center font-mono",children:"Select a Group"})})]}),a.jsx("div",{className:"mt-4 p-3 bg-gray-100 dark:bg-gray-800 border-t-2 border-gray-300 dark:border-gray-700 rounded-b-lg",children:(0,a.jsxs)("div",{className:"flex justify-center items-center gap-4 font-mono",children:[a.jsx("button",{onClick:eM,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded transition-colors",children:"[SAVE]"}),a.jsx("span",{className:"text-xs text-gray-500",children:"Export system data to CSV"}),a.jsx("div",{className:"w-px h-6 bg-gray-400"}),a.jsx("button",{onClick:eG,className:"px-6 py-2 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded transition-colors",children:"[LOAD]"}),a.jsx("span",{className:"text-xs text-gray-500",children:"Import system data from CSV"})]})}),a.jsx(i,{isOpen:ey,onClose:()=>ef(!1),onImportComplete:eb})]})}},461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>l,__esModule:()=>s,default:()=>n});let a=(0,r(6843).createProxy)(String.raw`/workspaces/ZQLC/app/browse/page.tsx`),{__esModule:s,$$typeof:l}=a,n=a.default}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[939,704],()=>r(8644));module.exports=a})();