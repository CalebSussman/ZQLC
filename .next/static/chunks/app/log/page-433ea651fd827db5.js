(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[19],{6153:function(e,t,r){Promise.resolve().then(r.bind(r,588))},588:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var a=r(3827),s=r(4090),n=r(5922);function o(){var e,t;let[r,o]=(0,s.useState)(new Date),[i,l]=(0,s.useState)([]),[d,c]=(0,s.useState)([]),[g,x]=(0,s.useState)(!1),[m,u]=(0,s.useState)(!1),[b,h]=(0,s.useState)(!1),[y,p]=(0,s.useState)(null),[v,k]=(0,s.useState)(null),[f,j]=(0,s.useState)(null),[_,N]=(0,s.useState)({x:0,y:0}),[w,S]=(0,s.useState)(null),[C,D]=(0,s.useState)({isDragging:!1,dragType:null,draggedItem:null,startPosition:{x:0,y:0},currentPosition:{x:0,y:0}}),[O,E]=(0,s.useState)(!1),[T,I]=(0,s.useState)(""),[L,A]=(0,s.useState)([]),[P,M]=(0,s.useState)(""),[z,R]=(0,s.useState)("step"),[U,X]=(0,s.useState)(!1),[Y,F]=(0,s.useState)(""),[q,W]=(0,s.useState)(null),[J,G]=(0,s.useState)(!1),B=(0,s.useRef)(null),Z=(0,s.useRef)(null);(0,s.useEffect)(()=>{x(!0);let e=()=>u(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{g&&(Q(),H())},[r,g]);let Q=async()=>{try{let{data:e,error:t}=await n.O.from("calendar_entries").select("*").eq("date",r.toISOString().split("T")[0]).order("start_time");if(t)throw t;let a=await Promise.all((e||[]).map(async e=>{let{data:t}=await n.O.from("task_details").select("id, code, title, current_status, current_status_name").eq("code",e.task_code).single(),r="";if(null==t?void 0:t.id){let{data:e}=await n.O.from("task_entries").select("note, entry_timestamp").eq("task_id",t.id).not("note","is",null).not("note","eq","").order("entry_timestamp",{ascending:!1}).limit(1).single(),{data:a}=await n.O.from("task_notes").select("content, created_at").eq("task_id",t.id).order("created_at",{ascending:!1}).limit(1).single(),s=(null==e?void 0:e.entry_timestamp)?new Date(e.entry_timestamp):null,o=(null==a?void 0:a.created_at)?new Date(a.created_at):null;s&&o?r=s>o?(null==e?void 0:e.note)||"":(null==a?void 0:a.content)||"":s?r=(null==e?void 0:e.note)||"":o&&(r=(null==a?void 0:a.content)||"")}return{...e,status_code:(null==t?void 0:t.current_status)||e.status_code,work_description:r||e.work_description||"",task_info:t}}));l(a)}catch(e){console.error("Error loading entries:",e)}},H=async()=>{try{let{data:e,error:t}=await n.O.from("task_details").select("*").in("status",["active"]).order("updated_at",{ascending:!1}).limit(50);if(t)throw t;c(e||[])}catch(e){console.error("Error loading tasks:",e)}},K=async e=>{if(!e.trim()){A([]);return}try{let{data:t,error:r}=await n.O.from("task_details").select("*").or("title.ilike.%".concat(e,"%,code.ilike.%").concat(e,"%,base_code.ilike.%").concat(e,"%")).limit(20);if(r)throw r;A(t||[])}catch(e){console.error("Error searching tasks:",e),A([])}},V=e=>{let[t,r]=e.split(":").map(Number);return 60*t+r},$=e=>"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0")),ee=e=>{if(!v||C.isDragging)return 64;let t=Math.abs(e-v);return 0===t?120:1===t?90:2===t?65:40},et=()=>{let e=[];for(let t=7;t<=23;t++){let r=ee(t)/4;for(let a=0;a<4;a++){let s=60*t+15*a,n=$(s);e.push({time:n,minutes:s,hour:t,quarter:a,height:r,label:0===a?"".concat(12===t?12:t>12?t-12:t).concat(t>=12?"PM":"AM"):""})}}return e},er=e=>"".concat(e.status_code,"-").concat(e.task_code),ea=async()=>{G(!0);try{let e=r.toISOString().split("T")[0],{data:t}=await n.O.from("calendar_entries").select("*").eq("date",e).order("start_time"),s=Array.from(new Set((null==t?void 0:t.map(e=>e.task_code))||[])),{data:o}=await n.O.from("task_details").select("*").in("base_code",s),l=(o||[]).reduce((e,t)=>(e[t.base_code]=t,e),{}),d={};null==t||t.forEach(e=>{let t=l[e.task_code];if(t){let r=t.universe_name||"Unknown";d[r]||(d[r]={name:r,entries:[]}),d[r].entries.push({...e,taskTitle:t.title,taskCode:t.base_code,fullStatusCode:er(e)})}});let c=Object.values(d).reduce((e,t)=>e+t.entries.length,0),g=new Set(Object.values(d).flatMap(e=>e.entries.map(e=>e.task_code))).size,x=(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-4 border border-blue-200 dark:border-blue-700",children:(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:c}),(0,a.jsx)("div",{className:"text-sm text-blue-800 dark:text-blue-300 font-mono",children:"Activities"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:g}),(0,a.jsx)("div",{className:"text-sm text-blue-800 dark:text-blue-300 font-mono",children:"Tasks"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:Object.keys(d).length}),(0,a.jsx)("div",{className:"text-sm text-blue-800 dark:text-blue-300 font-mono",children:"Universes"})]})]})}),0===Object.keys(d).length?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("div",{className:"text-gray-500 dark:text-gray-400 font-mono",children:"No activities logged for this date"})}):Object.entries(d).map(e=>{let[t,r]=e,s={Work:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700",Personal:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-700",Home:"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-700"}[t]||"bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700";return(0,a.jsxs)("div",{className:"rounded-lg p-4 border ".concat(s),children:[(0,a.jsx)("h3",{className:"font-mono font-bold text-lg mb-3",children:t.toUpperCase()}),(0,a.jsx)("div",{className:"space-y-2",children:r.entries.map((e,t)=>{let r=e.end_time?"".concat(e.start_time," - ").concat(e.end_time):"".concat(e.start_time," (ongoing)"),s={R:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",P:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",D:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",C:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",F:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300",X:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}[e.status_code]||"bg-gray-100 text-gray-800";return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded p-3 border border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"px-2 py-1 rounded text-xs font-mono ".concat(s),children:["[",e.fullStatusCode,"]"]}),(0,a.jsx)("span",{className:"font-mono text-sm text-gray-600 dark:text-gray-400",children:r})]})}),(0,a.jsx)("div",{className:"font-medium",children:e.taskTitle}),e.work_description&&e.work_description!==e.taskTitle&&(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.work_description})]},t)})}),(0,a.jsxs)("div",{className:"mt-3 text-sm text-gray-600 dark:text-gray-400 font-mono",children:[r.entries.length," activities in ",t]})]},t)}),(0,a.jsxs)("div",{className:"text-center text-sm text-gray-500 dark:text-gray-400 font-mono",children:["Generated on ",new Date().toLocaleString(),(0,a.jsx)("br",{}),"ATOL Semantic Ledger v1.0"]})]});W(x);let m=es(i);F(m),X(!0)}catch(e){console.error("Error generating SOA:",e)}finally{G(!1)}},es=e=>{let t=new Map;e.forEach(e=>{var r,a;let s=(null===(r=e.task_code)||void 0===r?void 0:r.substring(0,1))||"Other";t.has(s)||t.set(s,[]),null===(a=t.get(s))||void 0===a||a.push(e)});let a=e.length,s=e.reduce((e,t)=>(e[t.status_code]=(e[t.status_code]||0)+1,e),{}),n="# Statement of Activities\n";return n+="## Date: ".concat(r.toLocaleDateString(),"\n\n")+"### Summary\n"+"- **Total Activities:** ".concat(a,"\n")+"- **Received:** ".concat(s.R||0,"\n")+"- **Pending:** ".concat(s.P||0,"\n")+"- **Delivered:** ".concat(s.D||0,"\n")+"- **Completed:** ".concat(s.C||0,"\n")+"- **Cancelled:** ".concat(s.X||0,"\n\n"),Array.from(t.entries()).forEach(e=>{let[t,r]=e;n+="### ".concat("W"===t?"Work":"A"===t?"Admin":"C"===t?"Communication":t," Universe\n\n"),r.forEach(e=>{let t=e.end_time?15*Math.round((V(e.end_time)-V(e.start_time))/15):30;n+="- **".concat(e.task_code,"** [").concat(e.status_code,"] ").concat(e.work_description," (").concat(e.start_time," - ").concat(e.end_time||"ongoing",", ").concat(t,"m)\n")}),n+="\n"}),n+="\n---\nGenerated on ".concat(new Date().toLocaleString(),"\nATOL Semantic Ledger v1.0\n")},en=async(e,t)=>{try{let a=V(t),s=$(Math.min(a+30,1365)),o=e.base_code||e.code.substring(0,20),{error:i}=await n.O.from("calendar_entries").insert({task_code:o,status_code:e.current_status||"P",work_description:e.title,date:r.toISOString().split("T")[0],start_time:t,end_time:s,is_parallel:!1,track_number:1});if(i)throw i;let{error:l}=await n.O.rpc("create_task_entry",{p_task_id:e.id,p_status_code:e.current_status||"P",p_note:"Scheduled: ".concat(t," - ").concat(s," | ").concat(e.title),p_entry_timestamp:new Date().toISOString()});if(l)throw l;Q(),E(!1),I(""),A([])}catch(e){console.error("Error creating entry:",e),alert("Failed to create entry: "+e.message)}},eo=async(e,t)=>{try{let{data:r}=await n.O.from("calendar_entries").select("*").eq("id",e).single();if(!r)throw Error("Entry not found");let{error:a}=await n.O.from("calendar_entries").update(t).eq("id",e);if(a)throw a;if(t.status_code&&t.status_code!==r.status_code||void 0!==t.work_description&&t.work_description!==r.work_description){let{data:e}=await n.O.from("tasks").select("id").eq("base_code",r.task_code).single();if(e){let a="";t.status_code&&t.status_code!==r.status_code&&(a="Status changed to ".concat(t.status_code," via calendar")),void 0!==t.work_description&&t.work_description!==r.work_description&&(a&&(a+=" | "),a+="Note updated via calendar: ".concat(t.work_description||"cleared"));let{error:s}=await n.O.rpc("create_task_entry",{p_task_id:e.id,p_status_code:t.status_code||r.status_code,p_note:a,p_entry_timestamp:new Date().toISOString()});if(s&&console.error("Error creating task entry:",s),void 0!==t.work_description&&t.work_description!==r.work_description){let{error:r}=await n.O.from("task_notes").insert({task_id:e.id,type:z,content:t.work_description||"Note cleared via calendar"});r&&console.error("Error creating task note:",r)}}}Q()}catch(e){console.error("Error updating entry:",e),alert("Failed to update entry: "+e.message)}},ei=async e=>{try{let{error:t}=await n.O.from("calendar_entries").delete().eq("id",e);if(t)throw t;Q(),S(null)}catch(e){console.error("Error deleting entry:",e),alert("Failed to delete entry: "+e.message)}},el=(e,t,r)=>{if(e.preventDefault(),e.stopPropagation(),D({isDragging:!0,dragType:r,draggedItem:t,startPosition:{x:e.clientX,y:e.clientY},currentPosition:{x:e.clientX,y:e.clientY}}),Z.current){let a=Z.current;a.style.display="block",a.style.left="".concat(e.clientX+10,"px"),a.style.top="".concat(e.clientY+10,"px"),a.textContent="task"===r?"".concat(t.code," - ").concat(t.title):"".concat(t.task_code," (").concat(t.start_time,")")}},ed=e=>{if(C.isDragging&&(D(t=>({...t,currentPosition:{x:e.clientX,y:e.clientY}})),Z.current&&(Z.current.style.left="".concat(e.clientX+10,"px"),Z.current.style.top="".concat(e.clientY+10,"px")),B.current)){let t=B.current.getBoundingClientRect(),r=e.clientY-t.top,a=et(),s=0,n=null;for(let e of a){if(r>=s&&r<s+e.height){n=e.time;break}s+=e.height}p(n)}},ec=()=>{if(!C.isDragging||!C.draggedItem){eg();return}y&&B.current&&"task"===C.dragType&&en(C.draggedItem,y),eg()},eg=()=>{D({isDragging:!1,dragType:null,draggedItem:null,startPosition:{x:0,y:0},currentPosition:{x:0,y:0}}),p(null),Z.current&&(Z.current.style.display="none")};(0,s.useEffect)(()=>{let e=e=>{N({x:e.clientX,y:e.clientY}),C.isDragging&&ed(e)};return document.addEventListener("mousemove",e),C.isDragging&&document.addEventListener("mouseup",ec),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",ec)}},[C.isDragging,y]);let ex=e=>{let t=new Date(r);t.setDate(r.getDate()+("next"===e?1:-1)),o(t)},em=()=>r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),eu=()=>{let e=r.toLocaleDateString("en-US",{weekday:"long"}),t=r.toLocaleDateString("en-US",{month:"long"}),a=r.getDate(),s=r.getFullYear();return{weekday:e,month:t,dayYear:"".concat(a,", ").concat(s)}},eb=e=>{switch(e){case"R":return"bg-blue-500";case"P":return"bg-yellow-500";case"D":return"bg-purple-500";case"C":return"bg-green-500";case"F":return"bg-gray-500";case"X":return"bg-red-500";default:return"bg-gray-400"}};return g?(0,a.jsxs)("div",{className:"min-h-screen bg-[#F8F7F4] dark:bg-[#0A0A0B]",children:[(0,a.jsx)("div",{className:"border-b-2 border-gray-900 dark:border-gray-300 p-4",children:(0,a.jsx)("div",{className:"font-mono",children:m?(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"text-sm font-bold flex-1 leading-tight",children:[(0,a.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:eu().weekday}),(0,a.jsx)("div",{className:"text-base",children:eu().month}),(0,a.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:eu().dayYear})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-1",children:[(0,a.jsx)("button",{onClick:()=>o(new Date),className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 text-xs font-mono",children:"TODAY"}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("button",{onClick:()=>ex("prev"),className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 text-sm",children:"<"}),(0,a.jsx)("button",{onClick:()=>ex("next"),className:"px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 text-sm",children:">"})]})]}),(0,a.jsx)("div",{className:"w-px h-12 bg-gray-400 mx-2"}),(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,a.jsx)("button",{onClick:()=>h(!b),className:"px-2 py-1 rounded text-xs font-mono transition-colors ".concat(b?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"TASKS"}),(0,a.jsx)("button",{onClick:ea,disabled:J,className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded text-xs font-mono transition-colors",children:J?"GEN...":"SOA"})]})]})]}):(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:em()}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>ex("prev"),className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"[<]"}),(0,a.jsx)("button",{onClick:()=>o(new Date),className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 text-xs",children:"TODAY"}),(0,a.jsx)("button",{onClick:()=>ex("next"),className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"[>]"}),(0,a.jsx)("div",{className:"w-px h-6 bg-gray-400 mx-2"}),(0,a.jsx)("button",{onClick:()=>h(!b),className:"px-3 py-1 rounded text-xs font-mono transition-colors ".concat(b?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"[TASKS]"}),(0,a.jsx)("button",{onClick:ea,disabled:J,className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded text-xs font-mono transition-colors",children:J?"[GENERATING...]":"[SOA]"})]})]})})}),(0,a.jsxs)("div",{className:"flex",children:[b&&(0,a.jsx)("div",{className:"".concat(m?"fixed inset-0 z-40 bg-black/50":"w-80"),children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 h-full border-r border-gray-300 dark:border-gray-700 p-4 overflow-y-auto ".concat(m?"w-80 shadow-xl":""),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-mono font-bold",children:"Available Tasks"}),m&&(0,a.jsx)("button",{onClick:()=>h(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[d.map(e=>(0,a.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 cursor-move hover:shadow-md transition-shadow",onMouseDown:t=>el(t,e,"task"),children:[(0,a.jsx)("div",{className:"font-mono font-bold text-sm",children:e.display_code||e.base_code||e.code}),(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.title}),e.current_status&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Status: ",e.current_status]})]},e.id)),0===d.length&&(0,a.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No active tasks found"})]})]})}),(0,a.jsx)("div",{className:"flex-1 p-4",children:(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("div",{ref:B,className:"relative bg-white dark:bg-gray-900 rounded-lg border border-gray-300 dark:border-gray-700 overflow-hidden",onMouseLeave:()=>{p(null),j(null),k(null)},children:[et().map(e=>(0,a.jsxs)("div",{className:"relative border-b transition-all duration-300 ease-out ".concat(0===e.quarter?"border-gray-400 dark:border-gray-500":"border-gray-100 dark:border-gray-800"," ").concat(y===e.time&&C.isDragging?"bg-blue-50 dark:bg-blue-900/20":""," ").concat(C.isDragging?"":"hover:bg-gray-50 dark:hover:bg-gray-800/50"),style:{height:"".concat(e.height,"px")},onMouseEnter:()=>{C.isDragging||(p(e.time),k(e.hour))},onClick:()=>{C.isDragging||(M(e.time),E(!0))},children:[e.label&&(0,a.jsx)("div",{className:"absolute right-2 top-1 text-xs font-mono text-gray-500 z-20",children:e.label}),(0,a.jsx)("div",{className:"absolute left-2 top-0 w-4 h-px bg-gray-300 dark:bg-gray-600 z-20"}),y===e.time&&C.isDragging&&(0,a.jsx)("div",{className:"absolute inset-x-2 inset-y-1 border-2 border-dashed border-blue-400 dark:border-blue-500 rounded bg-blue-50 dark:bg-blue-900/20 z-10"}),!C.isDragging&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:(0,a.jsx)("div",{className:"text-xs text-gray-400 font-mono",children:"+ Add task"})})]},e.time)),(()=>{let e=[];return i.forEach(t=>{let r=V(t.start_time),a=t.end_time?V(t.end_time):r+60,s=!1;for(let n of e)if(n.some(e=>{let t=V(e.start_time);return r<(e.end_time?V(e.end_time):t+60)&&a>t})){n.push(t),s=!0;break}s||e.push([t])}),e.flatMap(e=>{let t=e.length;return e.map((e,r)=>{var s,n;let o=V(e.start_time),i=e.end_time?V(e.end_time):o+60,l=0,d=et();for(let e of d){if(e.minutes>=o)break;l+=e.height}let c=0;for(let e of d)e.minutes>=o&&e.minutes<i&&(c+=e.height);let g=Math.floor((window.innerWidth<768?window.innerWidth-70:((null===(s=B.current)||void 0===s?void 0:s.clientWidth)||800)-60)/t)-4,x={top:"".concat(l,"px"),height:"".concat(Math.max(c-4,20),"px"),left:"".concat(50+r*(g+4),"px"),width:"".concat(g,"px")};return(0,a.jsx)("div",{className:"absolute transition-all duration-200 cursor-pointer hover:opacity-80 rounded ".concat(eb(e.status_code)," ").concat((null==f?void 0:f.id)===e.id?"ring-2 ring-white ring-opacity-50":""),style:{...x,zIndex:30,margin:"2px"},onMouseEnter:()=>{j(e)},onMouseLeave:()=>j(null),onClick:t=>{t.preventDefault(),t.stopPropagation(),S(e)},children:(0,a.jsx)("div",{className:"absolute inset-0 flex items-center transition-all duration-200 ".concat((null==f?void 0:f.id)===e.id?"justify-end pr-4":"justify-center"),children:(0,a.jsxs)("div",{className:"text-xs text-white text-center",children:[(0,a.jsxs)("div",{className:"font-mono font-bold truncate",children:["[",e.status_code,"] ",e.task_code]}),(null===(n=e.task_info)||void 0===n?void 0:n.title)&&(0,a.jsx)("div",{className:"opacity-90 text-xs truncate font-medium",children:e.task_info.title}),(0,a.jsxs)("div",{className:"opacity-75 text-xs",children:[e.start_time," - ",e.end_time||"ongoing"]})]})})},e.id)})})})(),!C.isDragging&&0===i.length&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 pointer-events-none",children:(0,a.jsxs)("div",{className:"text-center font-mono",children:[(0,a.jsx)("div",{children:"Drag tasks from panel to schedule"}),(0,a.jsx)("div",{className:"text-sm mt-1",children:"Or click time slots to search tasks"})]})})]})})})]}),(0,a.jsx)("div",{ref:Z,className:"fixed z-50 bg-blue-600 text-white px-2 py-1 rounded shadow-lg font-mono text-sm pointer-events-none",style:{display:"none"}}),f&&(0,a.jsxs)("div",{className:"fixed z-40 bg-gray-900 text-white p-4 rounded-lg shadow-2xl border border-gray-700 font-mono text-sm max-w-sm",style:{left:"".concat(_.x+15,"px"),top:"".concat(_.y+15,"px"),pointerEvents:"none"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded ".concat(eb(f.status_code))}),(0,a.jsxs)("div",{className:"font-bold text-yellow-400",children:["[",f.status_code,"] ",f.task_code]})]}),(null===(e=f.task_info)||void 0===e?void 0:e.title)&&(0,a.jsxs)("div",{className:"mb-3 pb-2 border-b border-gray-700",children:[(0,a.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"Task:"}),(0,a.jsx)("div",{className:"text-xs text-white font-medium",children:f.task_info.title})]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Start:"}),(0,a.jsx)("span",{children:f.start_time})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"End:"}),(0,a.jsx)("span",{children:f.end_time||"Not set"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Duration:"}),(0,a.jsx)("span",{children:f.end_time?"".concat(V(f.end_time)-V(f.start_time)," min"):"Unknown"})]})]}),f.work_description&&(0,a.jsxs)("div",{className:"mt-3 pt-2 border-t border-gray-700",children:[(0,a.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"Work Notes:"}),(0,a.jsx)("div",{className:"text-xs text-gray-200",children:f.work_description})]}),(0,a.jsx)("div",{className:"mt-3 pt-2 border-t border-gray-700 text-xs text-gray-500",children:"Click to edit"})]}),O&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg w-full max-w-2xl max-h-96 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Schedule task at ",P," on ",r.toLocaleDateString()]}),(0,a.jsx)("input",{type:"text",placeholder:"Search existing tasks...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,value:T,onChange:e=>{I(e.target.value),K(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&(E(!1),I(""),A([])),"Enter"===e.key&&L.length>0&&en(L[0],P)}})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[T&&0===L.length&&(0,a.jsxs)("div",{className:"p-4 text-center text-gray-500",children:['No tasks found matching "',T,'"']}),L.length>0&&(0,a.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:L.map((e,t)=>(0,a.jsxs)("button",{onClick:()=>en(e,P),className:"w-full text-left p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[(0,a.jsxs)("div",{className:"font-mono font-bold",children:[e.display_code||e.base_code||e.code," - ",e.title]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[e.universe_name||"Unknown"," > ",e.phylum_name||"Unknown"]}),0===t&&(0,a.jsx)("div",{className:"text-xs text-blue-500 mt-1",children:"Press Enter to select"})]},e.id))}),!T&&(0,a.jsxs)("div",{className:"p-4 text-gray-500 text-sm",children:[(0,a.jsx)("p",{children:"Type to search for existing tasks to schedule"}),(0,a.jsx)("p",{className:"mt-2",children:"• Search by task title, code, or identifier"}),(0,a.jsx)("p",{children:"• Press Enter to select first result"}),(0,a.jsx)("p",{children:"• Press ESC to cancel"})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{E(!1),I(""),A([])},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Cancel"})})]})}),w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg w-full max-w-md",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("h3",{className:"font-mono font-bold",children:"Edit Entry"})}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-mono mb-1",children:"Task Code"}),(0,a.jsx)("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 font-mono",children:w.task_code}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Task code cannot be changed"})]}),(null===(t=w.task_info)||void 0===t?void 0:t.title)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-mono mb-1",children:"Task Title"}),(0,a.jsx)("div",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400",children:w.task_info.title}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Task title cannot be changed"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-mono mb-1",children:"Start Time"}),(0,a.jsx)("input",{type:"time",value:w.start_time,onChange:e=>S({...w,start_time:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-mono mb-1",children:"End Time"}),(0,a.jsx)("input",{type:"time",value:w.end_time||"",onChange:e=>S({...w,end_time:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-mono mb-2",children:"Work Notes"}),(0,a.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,a.jsx)("button",{onClick:()=>R("task"),className:"px-3 py-1 rounded text-xs ".concat("task"===z?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"Task Note"}),(0,a.jsx)("button",{onClick:()=>R("step"),className:"px-3 py-1 rounded text-xs ".concat("step"===z?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"Step Note"}),(0,a.jsx)("button",{onClick:()=>R("outcome"),className:"px-3 py-1 rounded text-xs ".concat("outcome"===z?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"Outcome Note"})]}),(0,a.jsx)("textarea",{value:w.work_description,onChange:e=>S({...w,work_description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800",rows:3,placeholder:"Add a ".concat(z," note...")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-mono mb-2",children:"Status"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[{code:"R",name:"Received",color:"bg-blue-500"},{code:"P",name:"Pending",color:"bg-yellow-500"},{code:"D",name:"Delivered",color:"bg-purple-500"},{code:"C",name:"Completed",color:"bg-green-500"},{code:"F",name:"Filed",color:"bg-gray-500"},{code:"X",name:"Cancelled",color:"bg-red-500"}].map(e=>(0,a.jsxs)("button",{onClick:()=>S({...w,status_code:e.code}),className:"p-2 rounded text-xs font-mono text-white transition-opacity ".concat(e.color," ").concat(w.status_code===e.code?"opacity-100":"opacity-50"),children:["[",e.code,"] ",e.name]},e.code))})]})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{eo(w.id,{status_code:w.status_code,work_description:w.work_description,start_time:w.start_time,end_time:w.end_time}),S(null)},className:"flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition-colors font-mono",children:"Save"}),(0,a.jsx)("button",{onClick:()=>{confirm("Delete this entry?")&&ei(w.id)},className:"flex-1 bg-red-600 text-white py-2 rounded hover:bg-red-700 transition-colors font-mono",children:"Delete"}),(0,a.jsx)("button",{onClick:()=>S(null),className:"flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600 transition-colors font-mono",children:"Cancel"})]})]})}),U&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-2 sm:p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg w-full max-w-4xl max-h-[95vh] sm:max-h-[90vh] flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg sm:text-xl font-mono font-bold",children:"Statement of Activities"}),(0,a.jsx)("div",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1 font-mono",children:em()})]}),(0,a.jsx)("button",{onClick:()=>X(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl",children:"✕"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:q}),(0,a.jsxs)("div",{className:"p-4 sm:p-6 border-t border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row gap-2 sm:gap-3",children:[(0,a.jsx)("button",{onClick:()=>{let e=r.toISOString().split("T")[0],t=new Blob([Y],{type:"text/markdown"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download="SOA-".concat(e,".md"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},className:"flex-1 bg-green-600 text-white py-3 px-4 rounded hover:bg-green-700 transition-colors font-mono text-xs sm:text-sm",children:"[DOWNLOAD .MD]"}),(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(Y),alert("SOA copied to clipboard!")},className:"flex-1 bg-blue-600 text-white py-3 px-4 rounded hover:bg-blue-700 transition-colors font-mono text-xs sm:text-sm",children:"[COPY]"}),(0,a.jsx)("button",{onClick:()=>X(!1),className:"flex-1 bg-gray-500 text-white py-3 px-4 rounded hover:bg-gray-600 transition-colors font-mono text-xs sm:text-sm",children:"[CLOSE]"})]})]})})]}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."})}},5922:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});let a=(0,r(7887).eI)("https://ofiindxmfiptivijhbdi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maWluZHhtZmlwdGl2aWpoYmRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzOTU4MjEsImV4cCI6MjA3Mzk3MTgyMX0.P9Qmhha1EL7X0uQ8CiUF6LXWqBCQt1pJwg3cmcHkfR0")}},function(e){e.O(0,[887,971,69,744],function(){return e(e.s=6153)}),_N_E=e.O()}]);