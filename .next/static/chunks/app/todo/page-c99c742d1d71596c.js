(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[435],{8369:function(e,t,r){Promise.resolve().then(r.bind(r,4445))},4445:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var a=r(3827),s=r(4090),n=r(7907),d=r(5922);function l(){(0,n.useRouter)();let[e,t]=(0,s.useState)(null),[r,l]=(0,s.useState)([]),[i,o]=(0,s.useState)(null),[c,u]=(0,s.useState)([]),[m,x]=(0,s.useState)(!1),[b,p]=(0,s.useState)(0);async function g(){let{data:e}=await d.O.from("current_card").select("*").single();t(e)}async function h(){if(!e)return;let{data:t}=await d.O.from("card_task_details").select("*").eq("card_id",e.id).order("position");if(t){let e=t.find(e=>e.base_code.startsWith("CCA-01.")&&e.title.toLowerCase().includes("file")),r=t.filter(t=>t!==e);o(e||null),l(r)}}async function f(){let{data:e}=await d.O.from("cards").select("*").eq("status","filed").order("end_date",{ascending:!1}).limit(10);u(e||[])}async function _(e){let t=["R","P","D","F","C","X"],r=(t.indexOf(e.current_status)+1)%t.length,a=t[r];await d.O.rpc("create_task_entry",{p_task_id:e.task_id,p_status_code:a,p_note:"Status changed via todo",p_entry_timestamp:new Date().toISOString()}),h()}async function y(){e&&i&&(await d.O.rpc("create_task_entry",{p_task_id:i.task_id,p_status_code:"C",p_note:"Filed ".concat(e.card_number),p_entry_timestamp:new Date().toISOString()}),await d.O.rpc("file_card",{p_card_id:e.id,p_filing_task_id:i.task_id}),g(),f())}(0,s.useEffect)(()=>{g(),f()},[]),(0,s.useEffect)(()=>{e&&(h(),function(){if(!e)return;let t=new Date(e.start_date);p(Math.ceil(Math.abs(new Date().getTime()-t.getTime())/864e5))}())},[e]);let v=e=>{switch(e){case"C":return"☑";case"X":return"☒";default:return"☐"}},k=e=>{switch(e){case"R":return"text-blue-600";case"P":return"text-yellow-600";case"D":case"C":return"text-green-600";case"F":return"text-gray-600";case"X":return"text-red-400";default:return""}};async function I(t){if(e)try{let{error:r}=await d.O.from("task_cards").delete().eq("task_id",t).eq("card_id",e.id);if(r)throw r;h()}catch(e){console.error("Error removing task from card:",e)}}return(0,a.jsx)("div",{className:"min-h-screen bg-[#F8F7F4] dark:bg-[#0A0A0B] p-4 sm:p-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8 pb-6 border-b-4 border-gray-900 dark:border-gray-300",children:[(0,a.jsxs)("div",{className:"flex items-baseline justify-between",children:[(0,a.jsxs)("h1",{className:"text-4xl font-mono font-bold",children:["ATOL-",(null==e?void 0:e.card_number)||"..."]}),(0,a.jsxs)("div",{className:"text-sm font-mono text-gray-600 dark:text-gray-400",children:["STARTED ",null==e?void 0:e.start_date," | DAY ",b]})]}),(0,a.jsx)("div",{className:"mt-4 h-2 bg-gray-200 dark:bg-gray-700 rounded",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-yellow-400 to-yellow-500 rounded",style:{width:"".concat((null==e?void 0:e.completed_tasks)&&(null==e?void 0:e.total_tasks)?e.completed_tasks/e.total_tasks*100:0,"%")}})})]}),(0,a.jsx)("div",{className:"space-y-3 mb-8",children:r.map(e=>(0,a.jsx)("div",{className:"group p-4 bg-white dark:bg-gray-900 rounded-lg border border-gray-300 dark:border-gray-700 hover:shadow-lg transition-all font-mono ".concat(k(e.current_status)),children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-2xl mr-3 cursor-pointer hover:scale-110 transition-transform",onClick:()=>_(e),children:v(e.current_status)}),(0,a.jsxs)("div",{className:"flex-1 cursor-pointer",onClick:()=>_(e),children:[(0,a.jsxs)("div",{className:"flex items-baseline",children:[(0,a.jsxs)("span",{className:"font-bold text-lg mr-2",children:["[",e.current_status,"]"]}),(0,a.jsx)("span",{className:"font-bold mr-3",children:e.base_code}),(0,a.jsxs)("span",{className:"text-gray-600 dark:text-gray-400",children:['"',e.title,'"']})]}),"C"===e.current_status&&(0,a.jsx)("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"✓ completed"}),"X"===e.current_status&&(0,a.jsx)("div",{className:"text-xs text-red-400 mt-1",children:"✗ cancelled"})]}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),I(e.task_id)},className:"opacity-0 group-hover:opacity-100 ml-2 px-2 py-1 text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all",title:"Remove from card",children:"\xd7"})]})},e.id))}),(0,a.jsx)("div",{className:"mb-8 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg font-mono text-center",children:(0,a.jsxs)("div",{className:"border-t border-b border-gray-400 dark:border-gray-600 py-2",children:[(null==e?void 0:e.total_tasks)||0," TASKS | ",(null==e?void 0:e.completed_tasks)||0," COMPLETE | ",(null==e?void 0:e.pending_tasks)||0," PENDING"]})}),i&&(0,a.jsx)("div",{className:"mb-8 p-6 bg-gradient-to-r from-purple-100 to-purple-200 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg border-4 border-double border-purple-600",children:(0,a.jsxs)("div",{className:"font-mono text-center",children:[(0,a.jsxs)("div",{className:"text-xl font-bold mb-2",children:[i.base_code,": FILE ATOL-",null==e?void 0:e.card_number," → ",(null==e?void 0:e.card_number)==="XVI"?"XVII":(null==e?void 0:e.card_number)==="XVII"?"XVIII":(null==e?void 0:e.card_number)==="XVIII"?"XIX":(null==e?void 0:e.card_number)==="XIX"?"XX":"XXI"]}),(0,a.jsx)("button",{onClick:y,className:"px-6 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition-colors",children:"[COMPLETE FILING]"})]})}),(0,a.jsxs)("div",{className:"flex justify-between items-center font-mono",children:[(0,a.jsxs)("button",{onClick:()=>{parseInt((null==e?void 0:e.card_number)||"0")},className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:["[<] ATOL-",(null==e?void 0:e.card_number)==="XVII"?"XVI":(null==e?void 0:e.card_number)==="XVIII"?"XVII":"XV"]}),(0,a.jsx)("button",{onClick:()=>x(!m),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"[ARCHIVES]"})]}),m&&(0,a.jsxs)("div",{className:"mt-8 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-mono font-bold mb-4",children:"Filed Cards:"}),(0,a.jsx)("div",{className:"space-y-2",children:c.map(e=>(0,a.jsxs)("div",{className:"font-mono text-sm",children:[(0,a.jsxs)("span",{className:"font-bold",children:["ATOL-",e.card_number]}),(0,a.jsxs)("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:[e.start_date," → ",e.end_date]}),(0,a.jsxs)("span",{className:"ml-3 text-gray-500",children:["(",e.total_tasks," tasks)"]})]},e.id))})]})]})})}},5922:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});let a=(0,r(7887).eI)("https://ofiindxmfiptivijhbdi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maWluZHhtZmlwdGl2aWpoYmRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzOTU4MjEsImV4cCI6MjA3Mzk3MTgyMX0.P9Qmhha1EL7X0uQ8CiUF6LXWqBCQt1pJwg3cmcHkfR0")},7907:function(e,t,r){"use strict";var a=r(5313);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[887,971,69,744],function(){return e(e.s=8369)}),_N_E=e.O()}]);