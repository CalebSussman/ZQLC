(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{575:function(e,t,s){Promise.resolve().then(s.bind(s,8039))},8039:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(3827),r=s(4090),n=s(7907),l=s(2209),i=s(5922),c=s(9079);let d=[{code:"R",name:"Received",description:"Task has been received and acknowledged"},{code:"D",name:"Delivered",description:"Task has been delivered or presented"},{code:"F",name:"Filed",description:"Task has been filed for future reference"},{code:"C",name:"Completed",description:"Task has been fully completed"},{code:"P",name:"Pending",description:"Task is pending external action"},{code:"X",name:"Cancelled",description:"Task has been cancelled"}];function o(){let e=(0,n.useParams)(),t=(0,n.useRouter)(),s=e.code,[o,x]=(0,r.useState)(null),[m,u]=(0,r.useState)([]),[h,p]=(0,r.useState)([]),[g,b]=(0,r.useState)(!0),[y,f]=(0,r.useState)(!1),[j,N]=(0,r.useState)(""),[v,k]=(0,r.useState)(3),[w,_]=(0,r.useState)(!1),[C,S]=(0,r.useState)(d[0]),[E,O]=(0,r.useState)(""),[I,T]=(0,r.useState)(""),[P,L]=(0,r.useState)("step"),[M,U]=(0,r.useState)(!1);async function X(){try{let{data:e,error:t}=await i.O.from("task_details").select("*").eq("base_code",s.toUpperCase()).single();if(!e){let a=await i.O.from("task_details").select("*").eq("code",s.toUpperCase()).single();e=a.data,t=a.error}if(t)throw t;x(e),N(e.title),k(e.priority)}catch(e){console.error("Error fetching task:",e)}finally{b(!1)}}async function q(){if(null==o?void 0:o.id)try{let{data:e,error:t}=await i.O.from("task_entry_history").select("*").eq("task_id",o.id).order("entry_timestamp",{ascending:!1});if(t)throw t;u(e||[])}catch(e){console.error("Error fetching entries:",e)}}async function D(){if(null==o?void 0:o.id)try{let{data:e,error:t}=await i.O.from("task_notes").select("*").eq("task_id",o.id).order("created_at",{ascending:!1});if(t)throw t;p(e||[])}catch(e){console.error("Error fetching notes:",e)}}async function J(){if(o)try{let{error:e}=await i.O.from("tasks").update({title:j,priority:v}).eq("id",o.id);if(e)throw e;x({...o,title:j,priority:v}),f(!1)}catch(e){console.error("Error updating task:",e)}}async function z(){if(o)try{let{data:e,error:t}=await i.O.rpc("create_task_entry",{p_task_id:o.id,p_status_code:C.code,p_note:E||null,p_entry_timestamp:new Date().toISOString()});if(t)throw t;await X(),await q(),_(!1),O("")}catch(e){console.error("Error creating entry:",e)}}async function A(){if(I.trim()&&o){U(!0);try{let{data:e,error:t}=await i.O.from("task_notes").insert({task_id:o.id,type:P,content:I}).select().single();if(t)throw t;p([e,...h]),T("")}catch(e){console.error("Error adding note:",e)}finally{U(!1)}}}async function F(){if(o&&confirm("Are you sure you want to delete this task? This action cannot be undone."))try{let{error:e}=await i.O.from("tasks").delete().eq("id",o.id);if(e)throw e;t.push("/")}catch(e){console.error("Error deleting task:",e)}}function R(e){if(!e)return"-";let t=e.match(/(\d+) days? (\d+):(\d+):(\d+)/);if(t){let[e,s,a,r]=t;return"".concat(s,"d ").concat(a,"h ").concat(r,"m")}let s=e.match(/(\d+):(\d+):(\d+)/);if(s){let[e,t,a]=s;return"".concat(t,"h ").concat(a,"m")}return e}if((0,r.useEffect)(()=>{s&&X()},[s]),(0,r.useEffect)(()=>{(null==o?void 0:o.id)&&(q(),D())},[o]),g)return(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading task..."})});if(!o)return(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Task Not Found"}),(0,a.jsxs)("p",{className:"text-gray-500 mb-6",children:['The task code "',s,"\" doesn't exist."]}),(0,a.jsx)("a",{href:"/",className:"text-blue-600 hover:text-blue-700",children:"← Back to Dashboard"})]});let B="".concat(c.env.NEXT_PUBLIC_APP_URL||"https://zq.lc","/t/").concat(o.base_code);return(0,a.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsx)("div",{className:"flex-1",children:y?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{type:"text",value:j,onChange:e=>N(e.target.value),className:"text-2xl font-bold w-full px-3 py-2 border rounded"}),(0,a.jsxs)("select",{value:v,onChange:e=>k(Number(e.target.value)),className:"px-3 py-2 border rounded",children:[(0,a.jsx)("option",{value:1,children:"P1 - Urgent"}),(0,a.jsx)("option",{value:2,children:"P2 - High"}),(0,a.jsx)("option",{value:3,children:"P3 - Medium"}),(0,a.jsx)("option",{value:4,children:"P4 - Low"}),(0,a.jsx)("option",{value:5,children:"P5 - Backlog"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:J,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"}),(0,a.jsx)("button",{onClick:()=>{f(!1),N(o.title),k(o.priority)},className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",children:"Cancel"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:o.title}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[(0,a.jsxs)("div",{children:["Current Code: ",(0,a.jsx)("span",{className:"font-mono",children:o.code})]}),(0,a.jsxs)("div",{children:["Base Code: ",(0,a.jsx)("span",{className:"font-mono",children:o.base_code})]}),(0,a.jsxs)("div",{children:["Path: ",o.universe_name," → ",o.phylum_name," ",o.family_name&&"→ ".concat(o.family_name)]}),o.group_name&&(0,a.jsxs)("div",{children:["Group: ",o.group_num," - ",o.group_name]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-sm ".concat("C"===o.current_status||"X"===o.current_status?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:o.current_status_name||"No Status"}),(0,a.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm ".concat(o.priority<=2?"bg-red-100 text-red-800":3===o.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:["Priority ",o.priority]}),o.time_outstanding&&(0,a.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-800",children:["Outstanding: ",R(o.time_outstanding)]})]})]})}),(0,a.jsxs)("div",{className:"ml-6 text-center",children:[(0,a.jsx)(l.tv,{value:B,size:120,level:"M",includeMargin:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Scan to open"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6 pt-4 border-t dark:border-gray-700",children:[(0,a.jsx)("button",{onClick:()=>_(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700",children:"+ New Entry"}),(0,a.jsx)("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Edit Task"}),(0,a.jsx)("button",{onClick:F,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete Task"})]})]}),w&&(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Create New Entry"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Status"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:d.map(e=>(0,a.jsxs)("button",{onClick:()=>S(e),className:"p-3 rounded border ".concat(C.code===e.code?"border-purple-500 bg-purple-50":"border-gray-300"),children:[(0,a.jsxs)("div",{className:"font-bold",children:[e.code," - ",e.name]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]},e.code))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Entry Note (Optional)"}),(0,a.jsx)("textarea",{value:E,onChange:e=>O(e.target.value),placeholder:"What happened with this status change?",rows:3,className:"w-full px-3 py-2 border rounded"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:z,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Create Entry"}),(0,a.jsx)("button",{onClick:()=>{_(!1),O("")},className:"px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500",children:"Cancel"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4",children:["Entry History (",m.length,")"]}),0===m.length?(0,a.jsx)("p",{className:"text-gray-500",children:"No entries yet. Create your first entry above!"}):(0,a.jsx)("div",{className:"space-y-3",children:m.map((e,t)=>(0,a.jsx)("div",{className:"border-l-4 border-purple-500 pl-4 py-2",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-mono text-sm mb-1",children:e.full_code}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:e.status_name}),(0,a.jsx)("span",{className:"text-gray-500",children:new Date(e.entry_timestamp).toLocaleString()}),0===t&&(0,a.jsx)("span",{className:"text-xs bg-green-100 px-2 py-1 rounded",children:"Current"})]}),e.note&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.note}),e.duration_from_previous&&t<m.length-1&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Duration from previous: ",R(e.duration_from_previous)]})]})})},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Add Note"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>L("task"),className:"px-3 py-1 rounded ".concat("task"===P?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700"),children:"Task Note"}),(0,a.jsx)("button",{onClick:()=>L("step"),className:"px-3 py-1 rounded ".concat("step"===P?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700"),children:"Step Note"}),(0,a.jsx)("button",{onClick:()=>L("outcome"),className:"px-3 py-1 rounded ".concat("outcome"===P?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700"),children:"Outcome Note"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("textarea",{value:I,onChange:e=>T(e.target.value),placeholder:"Add a ".concat(P," note..."),rows:3,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"}),(0,a.jsx)("button",{onClick:A,disabled:!I.trim()||M,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:M?"Adding...":"Add"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4",children:["Notes (",h.length,")"]}),0===h.length?(0,a.jsx)("p",{className:"text-gray-500",children:"No notes yet."}):(0,a.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,a.jsxs)("div",{className:"border-l-4 pl-4 py-2 ".concat("task"===e.type?"border-blue-500":"step"===e.type?"border-yellow-500":"border-green-500"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat("task"===e.type?"bg-blue-100 text-blue-800":"step"===e.type?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.type.toUpperCase()}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString()})]}),(0,a.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:e.content})]},e.id))})]})]})}},5922:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(7887).eI)("https://ofiindxmfiptivijhbdi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maWluZHhtZmlwdGl2aWpoYmRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzOTU4MjEsImV4cCI6MjA3Mzk3MTgyMX0.P9Qmhha1EL7X0uQ8CiUF6LXWqBCQt1pJwg3cmcHkfR0")}},function(e){e.O(0,[887,493,971,69,744],function(){return e(e.s=575)}),_N_E=e.O()}]);