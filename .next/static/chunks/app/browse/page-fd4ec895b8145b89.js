(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[368],{5196:function(e,t,a){Promise.resolve().then(a.bind(a,8902))},8902:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var r=a(3827),s=a(4090),l=a(7907),n=a(5922);function o(e){let{onCancel:t,onCreate:a,placeholder:l="Name",codeMaxLength:n=1,codeType:o="alpha",codePlaceholder:i="C"}=e,[d,c]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[p,g]=(0,s.useState)(!1),h=(0,s.useRef)(null);(0,s.useEffect)(()=>{h.current&&h.current.focus()},[]);let x=async()=>{if(!d.trim()||!u.trim()){alert("Please enter both code and name");return}g(!0);try{await a(d.trim(),u.trim()),c(""),m("")}catch(e){}finally{g(!1)}},y=()=>{c(""),m(""),t()},v=e=>{"Enter"===e.key&&(e.preventDefault(),x()),"Escape"===e.key&&(e.preventDefault(),y())};return(0,r.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("input",{type:"text",value:d,onChange:e=>{let t=e.target.value;"numeric"===o?c(t.replace(/\D/g,"").slice(0,n)):c(t.toUpperCase().slice(0,n))},onKeyDown:v,className:"".concat("numeric"===o?"w-16":"w-12"," px-2 py-2 font-mono bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-center focus:outline-none focus:ring-2 focus:ring-blue-500"),maxLength:n,placeholder:i,disabled:p}),(0,r.jsx)("input",{ref:h,type:"text",value:u,onChange:e=>{m(e.target.value)},onKeyDown:v,className:"flex-1 px-3 py-2 font-mono bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:l,disabled:p})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:x,disabled:p||!d.trim()||!u.trim(),className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded text-sm font-medium transition-colors",children:p?"Creating...":"Create"}),(0,r.jsx)("button",{onClick:y,disabled:p,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 text-white rounded text-sm font-medium transition-colors",children:"Cancel"})]}),d.trim()&&u.trim()&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:["Preview: ",d.toUpperCase()," - ",u]})]})})}function i(e){var t,a,l,o,i,d,c,u,m,p,g,h,x,y,v,f;let{isOpen:b,onClose:_,onImportComplete:N}=e,[k,j]=(0,s.useState)(null),[w,C]=(0,s.useState)(!1),[E,S]=(0,s.useState)(null),[I,T]=(0,s.useState)(!1),[O,A]=(0,s.useState)(!1),[D,P]=(0,s.useState)(!1),[R,L]=(0,s.useState)(0),[F,U]=(0,s.useState)(!1),[M,G]=(0,s.useState)(null),q=(0,s.useRef)(null),V=(0,s.useCallback)(async e=>{if(!e.name.toLowerCase().endsWith(".csv")){alert("Please select a CSV file");return}j(e),S(null),T(!1),C(!0),G(null);try{let t=await W(e),a=function(e){let t=e.split("\n").filter(e=>e.trim());if(0===t.length)throw Error("CSV file is empty");let a=t[0].split(",").map(e=>e.trim().replace(/"/g,"")),r=["type","universe_code","universe_name","phylum_code","phylum_name","family_code","family_name","group_num","group_name","task_num","task_title","task_status","task_priority","base_code","id","display_order"].filter(e=>!a.includes(e));if(r.length>0)throw Error("Missing required columns: ".concat(r.join(", ")));let s=[];for(let e=1;e<t.length;e++){let r=t[e].trim();if(r)try{let t=function(e){let t=[],a="",r=!1;for(let s=0;s<e.length;s++){let l=e[s];'"'===l?r&&'"'===e[s+1]?(a+='"',s++):r=!r:","!==l||r?a+=l:(t.push(a.trim()),a="")}return t.push(a.trim()),t}(r);if(t.length!==a.length)throw Error("Row ".concat(e+1,": Expected ").concat(a.length," columns, got ").concat(t.length));let l={_rowIndex:e+1};if(a.forEach((e,a)=>{let r=t[a];if(["group_num","task_num","task_priority","display_order"].includes(e)){let t=parseInt(r);l[e]=isNaN(t)?r:t}else l[e]=r}),!["universe","phylum","family","group","task"].includes(l.type))throw Error("Row ".concat(e+1,": Invalid type '").concat(l.type,"'"));s.push(l)}catch(t){throw Error("Row ".concat(e+1,": ").concat(t instanceof Error?t.message:"Parse error"))}}return s}(t),r=await Y(),s=function(e){let t=[],a=e.filter(e=>"universe"===e.type),r=e.filter(e=>"phylum"===e.type),s=e.filter(e=>"family"===e.type),l=e.filter(e=>"group"===e.type),n=e.filter(e=>"task"===e.type),o=new Set;a.forEach(e=>{var a;e.universe_code&&1===e.universe_code.length||t.push({type:"error",message:'Universe code must be single character: "'.concat(e.universe_code,'"'),rowIndex:e._rowIndex,field:"universe_code"}),o.has(e.universe_code)?t.push({type:"error",message:'Duplicate universe code: "'.concat(e.universe_code,'"'),rowIndex:e._rowIndex,field:"universe_code"}):o.add(e.universe_code),(null===(a=e.universe_name)||void 0===a?void 0:a.trim())||t.push({type:"error",message:"Universe name is required",rowIndex:e._rowIndex,field:"universe_name"})}),r.forEach(e=>{var a;e.phylum_code&&1===e.phylum_code.length||t.push({type:"error",message:'Phylum code must be single character: "'.concat(e.phylum_code,'"'),rowIndex:e._rowIndex,field:"phylum_code"}),o.has(e.universe_code)||t.push({type:"error",message:'Phylum references non-existent universe: "'.concat(e.universe_code,'"'),rowIndex:e._rowIndex,field:"universe_code"}),(null===(a=e.phylum_name)||void 0===a?void 0:a.trim())||t.push({type:"error",message:"Phylum name is required",rowIndex:e._rowIndex,field:"phylum_name"})});let i=new Set(r.map(e=>"".concat(e.universe_code,"-").concat(e.phylum_code)));return s.forEach(e=>{var a;e.family_code&&1===e.family_code.length||t.push({type:"error",message:'Family code must be single character: "'.concat(e.family_code,'"'),rowIndex:e._rowIndex,field:"family_code"});let r="".concat(e.universe_code,"-").concat(e.phylum_code);i.has(r)||t.push({type:"error",message:'Family references non-existent phylum: "'.concat(e.universe_code,"/").concat(e.phylum_code,'"'),rowIndex:e._rowIndex,field:"phylum_code"}),(null===(a=e.family_name)||void 0===a?void 0:a.trim())||t.push({type:"error",message:"Family name is required",rowIndex:e._rowIndex,field:"family_name"})}),l.forEach(e=>{var a;let r="string"==typeof e.group_num?parseInt(e.group_num):e.group_num;(isNaN(r)||r<1||r>99)&&t.push({type:"error",message:'Group number must be between 1-99: "'.concat(e.group_num,'"'),rowIndex:e._rowIndex,field:"group_num"}),(null===(a=e.group_name)||void 0===a?void 0:a.trim())||t.push({type:"error",message:"Group name is required",rowIndex:e._rowIndex,field:"group_name"})}),n.forEach(e=>{var a,r;let s="string"==typeof e.task_num?parseInt(e.task_num):e.task_num;(isNaN(s)||s<1||s>99)&&t.push({type:"error",message:'Task number must be between 1-99: "'.concat(e.task_num,'"'),rowIndex:e._rowIndex,field:"task_num"}),(null===(a=e.task_title)||void 0===a?void 0:a.trim())||t.push({type:"error",message:"Task title is required",rowIndex:e._rowIndex,field:"task_title"}),["R","P","D","F","C","X"].includes(e.task_status)||t.push({type:"error",message:'Invalid task status: "'.concat(e.task_status,'". Must be R/P/D/F/C/X'),rowIndex:e._rowIndex,field:"task_status"});let l="string"==typeof e.task_priority?parseInt(e.task_priority):e.task_priority;(isNaN(l)||l<1||l>5)&&t.push({type:"error",message:'Task priority must be between 1-5: "'.concat(e.task_priority,'"'),rowIndex:e._rowIndex,field:"task_priority"}),(null===(r=e.base_code)||void 0===r?void 0:r.match(/^[A-Z]{2,3}-\d{2}\.\d{2}$/))||t.push({type:"error",message:'Invalid base_code format: "'.concat(e.base_code,'". Expected: ABC-01.01'),rowIndex:e._rowIndex,field:"base_code"})}),[...t]}(a),l=function(e,t){let a={creates:{universes:0,phyla:0,families:0,groups:0,tasks:0},updates:{universes:0,phyla:0,families:0,groups:0,tasks:0},deletes:{universes:0,phyla:0,families:0,groups:0,tasks:0}},r=e.filter(e=>"universe"===e.type),s=e.filter(e=>"phylum"===e.type),l=e.filter(e=>"family"===e.type),n=e.filter(e=>"group"===e.type),o=e.filter(e=>"task"===e.type);return r.forEach(e=>{var r;let s=null===(r=t.universes)||void 0===r?void 0:r.find(t=>t.code===e.universe_code);s?s.name!==e.universe_name&&a.updates.universes++:a.creates.universes++}),s.forEach(e=>{var r;let s=null===(r=t.phyla)||void 0===r?void 0:r.find(t=>t.universe_code===e.universe_code&&t.code===e.phylum_code);s?s.name!==e.phylum_name&&a.updates.phyla++:a.creates.phyla++}),l.forEach(e=>{var r;let s=null===(r=t.families)||void 0===r?void 0:r.find(t=>t.universe_code===e.universe_code&&t.phylum_code===e.phylum_code&&t.code===e.family_code);s?s.name!==e.family_name&&a.updates.families++:a.creates.families++}),n.forEach(e=>{var r;let s=null===(r=t.groups)||void 0===r?void 0:r.find(t=>t.universe_code===e.universe_code&&t.phylum_code===e.phylum_code&&t.family_code===e.family_code&&t.group_num===e.group_num);s?s.name!==e.group_name&&a.updates.groups++:a.creates.groups++}),o.forEach(e=>{var r;let s=null===(r=t.tasks)||void 0===r?void 0:r.find(t=>t.base_code===e.base_code);s?(s.title!==e.task_title||s.current_status!==e.task_status||s.priority!==e.task_priority)&&a.updates.tasks++:a.creates.tasks++}),a}(a,r),n=function(e,t){let a=new Set(e.filter(e=>"task"===e.type).map(e=>e.base_code));return t.filter(e=>!a.has(e.base_code)).map(e=>({id:e.id,base_code:e.base_code,title:e.title,current_status:e.current_status||e.status,universe_name:e.universe_name||"Unknown"}))}(a,r.tasks||[]),o={isValid:0===s.filter(e=>"error"===e.type).length,errors:s.filter(e=>"error"===e.type),warnings:s.filter(e=>"warning"===e.type),changes:l,tasksToDelete:n,parsedData:a};S(o)}catch(e){G(e instanceof Error?e.message:"Failed to process CSV file")}finally{C(!1)}},[]),W=e=>new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;return t(null===(a=e.target)||void 0===a?void 0:a.result)},r.onerror=()=>a(Error("Failed to read file")),r.readAsText(e)}),Y=async()=>{let[{data:e},{data:t},{data:a},{data:r},{data:s}]=await Promise.all([n.O.from("universes").select("*"),n.O.from("phyla").select("*, universe:universes(code, name)"),n.O.from("families").select("*, phylum:phyla(code, name, universe:universes(code, name))"),n.O.from("groups_with_counts").select("*"),n.O.from("task_details").select("*")]);return{universes:e,phyla:t,families:a,groups:r,tasks:s}},B=async()=>{if(E&&E.isValid){P(!0),L(0),G(null);try{var e,t;if((null!==(t=null===(e=E.tasksToDelete)||void 0===e?void 0:e.length)&&void 0!==t?t:0)>0&&!I){G("Please confirm deletion of existing tasks before proceeding"),P(!1);return}L(50);let{error:a}=await n.O.rpc("bulk_import_system_data",{import_data:E.parsedData,delete_missing_tasks:I});if(a)throw Error(a.message);L(100),U(!0),setTimeout(()=>{null==N||N(),_(),K()},2e3)}catch(e){G(e instanceof Error?e.message:"Import failed")}finally{P(!1)}}},K=()=>{j(null),S(null),T(!1),A(!1),P(!1),L(0),U(!1),G(null),C(!1)},H=()=>{D||(K(),_())};return b?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-2 sm:p-4",children:(0,r.jsxs)("div",{className:"bg-black text-green-400 font-mono rounded-lg w-full max-w-4xl max-h-[95vh] flex flex-col border-2 border-green-400",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-green-400 flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-green-400",children:"SYSTEM DATA IMPORT - TERMINAL"}),(0,r.jsx)("button",{onClick:H,disabled:D,className:"text-green-400 hover:text-green-300 disabled:opacity-50",children:"[X]"})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[!k&&(0,r.jsxs)("div",{className:"border-2 border-dashed border-green-400 p-8 text-center cursor-pointer hover:border-green-300 transition-colors",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation();let t=Array.from(e.dataTransfer.files);t.length>0&&V(t[0])},onClick:()=>{var e;return null===(e=q.current)||void 0===e?void 0:e.click()},children:[(0,r.jsx)("div",{className:"text-lg mb-2",children:"> DRAG CSV FILE HERE OR [BROWSE FILE]"}),(0,r.jsx)("div",{className:"text-sm text-green-300",children:"Expected format: ATOL system export CSV"}),(0,r.jsx)("input",{ref:q,type:"file",accept:".csv",onChange:e=>{var t;return(null===(t=e.target.files)||void 0===t?void 0:t[0])&&V(e.target.files[0])},className:"hidden"})]}),k&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:["> FILE LOADED: ",k.name," (",(k.size/1024/1024).toFixed(2),"MB)"]}),w&&(0,r.jsx)("div",{children:"> PARSING AND VALIDATING..."}),E&&!w&&(0,r.jsxs)("div",{children:["> PARSING COMPLETE: ",E.parsedData.length," RECORDS DETECTED"]})]}),E&&!w&&(0,r.jsxs)("div",{className:"border border-green-400 p-4 space-y-2",children:[(0,r.jsx)("div",{className:"text-yellow-400",children:"─ VALIDATION RESULTS ─────────────────────────"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-green-400",children:"[+] CSV FORMAT: VALID"}),(0,r.jsx)("div",{className:"text-green-400",children:"[+] REQUIRED COLUMNS: FOUND"}),E.errors.length>0&&(0,r.jsxs)("div",{className:"text-red-400",children:["[-] ERRORS: ",E.errors.length," FOUND",(0,r.jsxs)("div",{className:"ml-4 text-sm space-y-1",children:[E.errors.slice(0,5).map((e,t)=>(0,r.jsxs)("div",{children:["- Row ",e.rowIndex,": ",e.message]},t)),E.errors.length>5&&(0,r.jsxs)("div",{children:["- (",E.errors.length-5," more errors...)"]})]})]}),E.warnings.length>0&&(0,r.jsxs)("div",{className:"text-yellow-400",children:["[!] WARNINGS: ",E.warnings.length," FOUND"]})]}),E.isValid&&(0,r.jsxs)("div",{className:"mt-4 space-y-1",children:[(0,r.jsx)("div",{className:"text-yellow-400",children:"CHANGES PREVIEW:"}),(0,r.jsxs)("div",{className:"ml-2 space-y-1",children:[E.changes.creates.universes>0&&(0,r.jsxs)("div",{children:["• ",E.changes.creates.universes," NEW UNIVERSES"]}),E.changes.creates.phyla>0&&(0,r.jsxs)("div",{children:["• ",E.changes.creates.phyla," NEW PHYLA"]}),E.changes.creates.families>0&&(0,r.jsxs)("div",{children:["• ",E.changes.creates.families," NEW FAMILIES"]}),E.changes.creates.groups>0&&(0,r.jsxs)("div",{children:["• ",E.changes.creates.groups," NEW GROUPS"]}),E.changes.creates.tasks>0&&(0,r.jsxs)("div",{children:["• ",E.changes.creates.tasks," NEW TASKS"]}),E.changes.updates.universes>0&&(0,r.jsxs)("div",{children:["• ",E.changes.updates.universes," UPDATED UNIVERSES"]}),E.changes.updates.phyla>0&&(0,r.jsxs)("div",{children:["• ",E.changes.updates.phyla," UPDATED PHYLA"]}),E.changes.updates.families>0&&(0,r.jsxs)("div",{children:["• ",E.changes.updates.families," UPDATED FAMILIES"]}),E.changes.updates.groups>0&&(0,r.jsxs)("div",{children:["• ",E.changes.updates.groups," UPDATED GROUPS"]}),E.changes.updates.tasks>0&&(0,r.jsxs)("div",{children:["• ",E.changes.updates.tasks," UPDATED TASKS"]})]}),(null!==(p=null===(t=E.tasksToDelete)||void 0===t?void 0:t.length)&&void 0!==p?p:0)>0&&(0,r.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,r.jsx)("div",{className:"text-red-400",children:"[!] DELETION DETECTED:"}),(0,r.jsxs)("div",{className:"ml-2",children:[(0,r.jsxs)("div",{className:"text-red-400",children:["• ",null!==(g=null===(a=E.tasksToDelete)||void 0===a?void 0:a.length)&&void 0!==g?g:0," TASKS IN DATABASE NOT IN IMPORT FILE"]}),O?(0,r.jsx)("div",{className:"ml-4 text-sm space-y-1 max-h-32 overflow-y-auto",children:null===(l=E.tasksToDelete)||void 0===l?void 0:l.map((e,t)=>(0,r.jsxs)("div",{children:["- ",e.base_code,' "',e.title,'" (',e.current_status,")"]},t))}):(0,r.jsxs)("div",{className:"ml-4 text-sm space-y-1",children:[null===(o=E.tasksToDelete)||void 0===o?void 0:o.slice(0,3).map((e,t)=>(0,r.jsxs)("div",{children:["- ",e.base_code,' "',e.title,'"']},t)),(null!==(h=null===(i=E.tasksToDelete)||void 0===i?void 0:i.length)&&void 0!==h?h:0)>3&&(0,r.jsxs)("button",{onClick:()=>A(!0),className:"text-yellow-400 hover:text-yellow-300 underline",children:["(",(null!==(x=null===(d=E.tasksToDelete)||void 0===d?void 0:d.length)&&void 0!==x?x:0)-3," more tasks - click to expand)"]})]}),(0,r.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"confirmDelete",checked:I,onChange:e=>T(e.target.checked),className:"rounded"}),(0,r.jsxs)("label",{htmlFor:"confirmDelete",className:"text-red-400",children:["[ ] CONFIRM DELETION OF ",null!==(y=null===(c=E.tasksToDelete)||void 0===c?void 0:c.length)&&void 0!==y?y:0," TASKS"]})]})]})]})]})]}),D&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{children:"> IMPORTING DATA..."}),(0,r.jsx)("div",{className:"bg-green-900 w-full h-4 rounded",children:(0,r.jsx)("div",{className:"bg-green-400 h-full rounded transition-all duration-300",style:{width:"".concat(R,"%")}})}),(0,r.jsxs)("div",{children:["> PROGRESS: ",R,"%"]})]}),F&&(0,r.jsxs)("div",{className:"text-green-400 space-y-1",children:[(0,r.jsx)("div",{children:"> IMPORT COMPLETE [OK]"}),(0,r.jsx)("div",{children:"> SYSTEM DATA UPDATED SUCCESSFULLY"}),(0,r.jsx)("div",{children:"> CLOSING TERMINAL..."})]}),M&&(0,r.jsx)("div",{className:"text-red-400",children:(0,r.jsxs)("div",{children:["> ERROR: ",M]})})]}),(0,r.jsxs)("div",{className:"p-4 border-t border-green-400 flex flex-wrap gap-2 justify-between",children:[(0,r.jsxs)("div",{className:"text-xs text-green-300",children:["[!] WARNING: THIS WILL MODIFY SYSTEM DATA",(0,r.jsx)("br",{}),"[!] BACKUP RECOMMENDED BEFORE PROCEEDING"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:H,disabled:D,className:"px-4 py-2 border border-green-400 text-green-400 hover:bg-green-400 hover:text-black transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"[CANCEL]"}),(null!==(v=null==E?void 0:null===(u=E.tasksToDelete)||void 0===u?void 0:u.length)&&void 0!==v?v:0)>0&&(0,r.jsx)("button",{onClick:()=>A(!O),className:"px-4 py-2 border border-yellow-400 text-yellow-400 hover:bg-yellow-400 hover:text-black transition-colors",children:"[PREVIEW DELETIONS]"}),(0,r.jsx)("button",{onClick:B,disabled:!(null==E?void 0:E.isValid)||D||(null!==(f=null==E?void 0:null===(m=E.tasksToDelete)||void 0===m?void 0:m.length)&&void 0!==f?f:0)>0&&!I,className:"px-4 py-2 border border-green-400 text-green-400 hover:bg-green-400 hover:text-black transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:D?"[IMPORTING...]":"[IMPORT]"})]})]})]})}):null}function d(){let e=(0,l.useRouter)(),[t,a]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)("UNI"),[p,g]=(0,s.useState)([]),[h,x]=(0,s.useState)([]),[y,v]=(0,s.useState)([]),[f,b]=(0,s.useState)([]),[_,N]=(0,s.useState)([]),[k,j]=(0,s.useState)(null),[w,C]=(0,s.useState)(null),[E,S]=(0,s.useState)(null),[I,T]=(0,s.useState)(null),[O,A]=(0,s.useState)(!1),[D,P]=(0,s.useState)(!1),[R,L]=(0,s.useState)(!1),[F,U]=(0,s.useState)(!1),[M,G]=(0,s.useState)(!1),[q,V]=(0,s.useState)(""),[W,Y]=(0,s.useState)(""),[B,K]=(0,s.useState)(""),[H,z]=(0,s.useState)(""),[X,J]=(0,s.useState)(""),[Z,Q]=(0,s.useState)(""),[$,ee]=(0,s.useState)(""),[et,ea]=(0,s.useState)(""),[er,es]=(0,s.useState)(""),[el,en]=(0,s.useState)(""),[eo,ei]=(0,s.useState)(null),[ed,ec]=(0,s.useState)(null),[eu,em]=(0,s.useState)(""),[ep,eg]=(0,s.useState)(""),[eh,ex]=(0,s.useState)(""),[ey,ev]=(0,s.useState)(!1),ef=(0,s.useCallback)(async()=>{try{let{data:e,error:t}=await n.O.from("universes").select("*").order("display_order");t?console.error("Error in loadUniverses:",t):g(e||[])}catch(e){console.error("Exception in loadUniverses:",e)}},[]),eb=(0,s.useCallback)(async()=>{if(k)try{let{data:e}=await n.O.from("phyla").select("*").eq("universe_id",k.id).order("display_order");x(e||[])}catch(e){console.error("Error loading phylums:",e)}},[k]),e_=(0,s.useCallback)(async()=>{if(w)try{let{data:e}=await n.O.from("families").select("*").eq("phylum_id",w.id).order("display_order");v(e||[])}catch(e){console.error("Error loading families:",e)}},[w]),eN=(0,s.useCallback)(async()=>{if(w&&k)try{let e=n.O.from("groups_with_counts").select("*").eq("universe_id",k.id).eq("phylum_id",w.id);E?e.eq("family_id",E.id):e.is("family_id",null);let{data:t}=await e.order("group_num");b(t||[])}catch(e){console.error("Error loading groups:",e)}},[w,k,E]),ek=(0,s.useCallback)(async()=>{if(w&&k&&I)try{let e=n.O.from("task_details").select("*").eq("universe_id",k.id).eq("phylum_id",w.id).eq("group_num",I.group_num);E&&e.eq("family_id",E.id);let{data:t}=await e.order("task_num");N(t||[])}catch(e){console.error("Error loading tasks:",e)}},[w,k,I,E]);if((0,s.useEffect)(()=>{a(!0);let e=()=>c(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{t&&ef()},[t]),(0,s.useEffect)(()=>{t&&k&&(eb(),d&&m("PHY"))},[k,t,d]),(0,s.useEffect)(()=>{t&&w&&(e_(),eN(),d&&m("FAM"))},[w,t,d]),(0,s.useEffect)(()=>{t&&w&&I&&(ek(),d&&m("TSK"))},[I,t,w,d]),!t)return(0,r.jsx)("div",{className:"min-h-screen bg-[#F8F7F4] dark:bg-[#0A0A0B] flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-gray-500 font-mono",children:"Loading..."})});async function ej(e,t){let a=e||q,r=t||W;if(!(null==a?void 0:a.trim())||!(null==r?void 0:r.trim())){alert("Please enter both a code and name");return}let s=a.trim().toUpperCase().slice(0,1),l=p.find(e=>e.code===s);if(l){alert('A universe with code "'.concat(s,'" already exists: ').concat(l.name));return}try{let{data:e,error:t}=await n.O.from("universes").insert({code:s,name:r.trim(),color:"#"+Math.floor(16777215*Math.random()).toString(16),display_order:p.length+1}).select().single();if(t){console.error("Supabase error:",t),alert("Error creating universe: ".concat(t.message));return}e&&(g(t=>[...t,e]),A(!1),V(""),Y(""),await ef())}catch(e){console.error("Exception in createUniverse:",e),alert("Failed to create universe: ".concat((null==e?void 0:e.message)||e))}}async function ew(e,t){let a=e||B,r=t||H;if(!(null==a?void 0:a.trim())||!(null==r?void 0:r.trim())||!k){alert("Please enter both a code and name");return}let s=a.trim().toUpperCase().slice(0,1),l=h.find(e=>e.code===s);if(l){alert('A phylum with code "'.concat(s,'" already exists: ').concat(l.name));return}try{let{data:e,error:t}=await n.O.from("phyla").insert({universe_id:k.id,code:s,name:r.trim()}).select().single();if(t){alert("Error creating phylum: ".concat(t.message));return}e&&(x(t=>[...t,e]),P(!1),K(""),z(""),await eb())}catch(e){console.error("Error creating phylum:",e),alert("Failed to create phylum: ".concat((null==e?void 0:e.message)||e))}}async function eC(e,t){let a=e||X,r=t||Z;if(!(null==a?void 0:a.trim())||!(null==r?void 0:r.trim())||!w){alert("Please enter both a code and name");return}let s=a.trim().toUpperCase().slice(0,1),l=y.find(e=>e.code===s);if(l){alert('A family with code "'.concat(s,'" already exists: ').concat(l.name));return}try{let{data:e,error:t}=await n.O.from("families").insert({phylum_id:w.id,code:s,name:r.trim()}).select().single();if(t){alert("Error creating family: ".concat(t.message));return}e&&(v(t=>[...t,e]),L(!1),J(""),Q(""),await e_())}catch(e){console.error("Error creating family:",e),alert("Failed to create family: ".concat((null==e?void 0:e.message)||e))}}async function eE(e,t){let a=e||et,r=t||$;if(!(null==a?void 0:a.trim())||!(null==r?void 0:r.trim())||!w||!k){alert("Please enter both a group number and name");return}let s=parseInt(a.trim());if(isNaN(s)||s<1||s>99){alert("Group number must be between 1 and 99");return}let l=f.find(e=>e.group_num===s);if(l){alert('A group with number "'.concat(s,'" already exists: ').concat(l.name));return}try{let{data:e,error:t}=await n.O.from("groups").insert({universe_id:k.id,phylum_id:w.id,family_id:(null==E?void 0:E.id)||null,group_num:s,name:r.trim()}).select().single();if(t){alert("Error creating group: ".concat(t.message));return}e&&(U(!1),ea(""),ee(""),await eN())}catch(e){console.error("Error creating group:",e),alert("Failed to create group: ".concat((null==e?void 0:e.message)||e))}}async function eS(){if(!er||!el||!I||!w||!k)return;let e=new Date,t=e.toISOString().replace("T","_").replace(/[-:]/g,".").substring(0,16),a="".concat(k.code).concat(w.code).concat((null==E?void 0:E.code)||"","-").concat(String(I.group_num).padStart(2,"0"),".").concat(el.padStart(2,"0")).toUpperCase(),r="R-".concat(t,"=").concat(a);try{let{data:t,error:s}=await n.O.from("tasks").insert({code:r,base_code:a,title:er,universe_id:k.id,phylum_id:w.id,family_id:(null==E?void 0:E.id)||null,group_num:I.group_num,task_num:parseInt(el),priority:3,status:"active",task_timestamp:e.toISOString()}).select().single();if(s)throw s;t&&(await n.O.rpc("create_task_entry",{p_task_id:t.id,p_status_code:"R",p_note:"Initial entry",p_entry_timestamp:e.toISOString()}),ek(),G(!1),es(""),en(""))}catch(e){console.error("Error creating task:",e)}}async function eI(e,t,a){try{let{error:r}=await n.O.from("universes").update({code:t.toUpperCase().slice(0,1),name:a}).eq("id",e);if(r)throw r;g(p.map(r=>r.id===e?{...r,code:t.toUpperCase().slice(0,1),name:a}:r)),ei(null),ec(null),em(""),eg("")}catch(e){console.error("Error updating universe:",e),alert("Failed to update universe")}}async function eT(e,t,a){try{let{error:r}=await n.O.from("phyla").update({code:t.toUpperCase().slice(0,1),name:a}).eq("id",e);if(r)throw r;x(h.map(r=>r.id===e?{...r,code:t.toUpperCase().slice(0,1),name:a}:r)),ei(null),ec(null),em(""),eg("")}catch(e){console.error("Error updating phylum:",e),alert("Failed to update phylum")}}async function eO(e,t,a){try{let{error:r}=await n.O.from("families").update({code:t.toUpperCase().slice(0,1),name:a}).eq("id",e);if(r)throw r;v(y.map(r=>r.id===e?{...r,code:t.toUpperCase().slice(0,1),name:a}:r)),ei(null),ec(null),em(""),eg("")}catch(e){console.error("Error updating family:",e),alert("Failed to update family")}}async function eA(e,t){try{let{error:a}=await n.O.from("groups").update({name:t}).eq("id",e);if(a)throw a;b(f.map(a=>a.id===e?{...a,name:t}:a)),ei(null),ec(null),em(""),eg("")}catch(e){console.error("Error updating group:",e),alert("Failed to update group")}}async function eD(e,t){if(confirm('Are you sure you want to delete the universe "'.concat(t,'"? This will also delete all associated phyla, families, groups, and tasks. This action cannot be undone.')))try{let{error:t}=await n.O.from("universes").delete().eq("id",e);if(t)throw t;g(p.filter(t=>t.id!==e)),(null==k?void 0:k.id)===e&&(j(null),C(null),S(null),T(null))}catch(e){console.error("Error deleting universe:",e),alert("Failed to delete universe")}}async function eP(e,t){if(confirm('Are you sure you want to delete the phylum "'.concat(t,'"? This will also delete all associated families, groups, and tasks. This action cannot be undone.')))try{let{error:t}=await n.O.from("phyla").delete().eq("id",e);if(t)throw t;x(h.filter(t=>t.id!==e)),(null==w?void 0:w.id)===e&&(C(null),S(null),T(null))}catch(e){console.error("Error deleting phylum:",e),alert("Failed to delete phylum")}}async function eR(e,t){if(confirm('Are you sure you want to delete the family "'.concat(t,'"? This will also delete all associated groups and tasks. This action cannot be undone.')))try{let{error:t}=await n.O.from("families").delete().eq("id",e);if(t)throw t;v(y.filter(t=>t.id!==e)),(null==E?void 0:E.id)===e&&(S(null),T(null))}catch(e){console.error("Error deleting family:",e),alert("Failed to delete family")}}async function eL(e,t){if(confirm('Are you sure you want to delete the group "'.concat(t,'"? This will also delete all associated tasks. This action cannot be undone.')))try{let{error:t}=await n.O.from("groups").delete().eq("id",e);if(t)throw t;b(f.filter(t=>t.id!==e)),(null==I?void 0:I.id)===e&&T(null)}catch(e){console.error("Error deleting group:",e),alert("Failed to delete group")}}let eF=(e,t,a,r)=>{ei(e),ec(t),eg(a),em(r)},eU=()=>{ei(null),ec(null),em(""),eg(""),ex("")},eM=async()=>{if(eo&&ed){if(ex(""),!eu.trim()){ex("Name is required");return}if("group"!==eo&&!ep.trim()){ex("Code is required");return}if("group"!==eo&&(()=>{switch(eo){case"universe":return p.some(e=>e.id!==ed&&e.code.toLowerCase()===ep.toLowerCase());case"phylum":return h.some(e=>e.id!==ed&&e.code.toLowerCase()===ep.toLowerCase());case"family":return y.some(e=>e.id!==ed&&e.code.toLowerCase()===ep.toLowerCase());default:return!1}})()){ex('Code "'.concat(ep,'" already exists'));return}switch(eo){case"universe":await eI(ed,ep,eu);break;case"phylum":await eT(ed,ep,eu);break;case"family":await eO(ed,ep,eu);break;case"group":await eA(ed,eu)}}};async function eG(){try{let{data:e}=await n.O.from("task_details").select("*").order("universe_code, phylum_code, family_code, group_num, task_num"),{data:t}=await n.O.from("universes").select("*").order("display_order"),{data:a}=await n.O.from("phyla").select("*, universe:universes(code, name)").order("display_order"),{data:r}=await n.O.from("families").select("*, phylum:phyla(code, name, universe:universes(code, name))").order("display_order"),{data:s}=await n.O.from("groups_with_counts").select("*").order("group_num"),l=[],o=new Set;null==t||t.forEach(e=>{let t="universe-".concat(e.code);o.has(t)||(l.push({type:"universe",universe_code:e.code,universe_name:e.name,phylum_code:"",phylum_name:"",family_code:"",family_name:"",group_num:"",group_name:"",task_num:"",task_title:"",task_status:"",task_priority:"",base_code:"",id:e.id,display_order:e.display_order||0}),o.add(t))}),null==a||a.forEach(e=>{var t,a,r;let s="phylum-".concat(null===(t=e.universe)||void 0===t?void 0:t.code,"-").concat(e.code);o.has(s)||(l.push({type:"phylum",universe_code:(null===(a=e.universe)||void 0===a?void 0:a.code)||"",universe_name:(null===(r=e.universe)||void 0===r?void 0:r.name)||"",phylum_code:e.code,phylum_name:e.name,family_code:"",family_name:"",group_num:"",group_name:"",task_num:"",task_title:"",task_status:"",task_priority:"",base_code:"",id:e.id,display_order:e.display_order||0}),o.add(s))}),null==r||r.forEach(e=>{var t,a,r,s,n,i;let d=(null===(a=e.phylum)||void 0===a?void 0:null===(t=a.universe)||void 0===t?void 0:t.code)||"",c=(null===(r=e.phylum)||void 0===r?void 0:r.code)||"",u="family-".concat(d,"-").concat(c,"-").concat(e.code);o.has(u)||(l.push({type:"family",universe_code:d,universe_name:(null===(n=e.phylum)||void 0===n?void 0:null===(s=n.universe)||void 0===s?void 0:s.name)||"",phylum_code:c,phylum_name:(null===(i=e.phylum)||void 0===i?void 0:i.name)||"",family_code:e.code,family_name:e.name,group_num:"",group_name:"",task_num:"",task_title:"",task_status:"",task_priority:"",base_code:"",id:e.id,display_order:e.display_order||0}),o.add(u))}),null==s||s.forEach(e=>{let s=null==t?void 0:t.find(t=>t.id===e.universe_id),n=null==a?void 0:a.find(t=>t.id===e.phylum_id),i=null==r?void 0:r.find(t=>t.id===e.family_id),d="group-".concat(null==s?void 0:s.code,"-").concat(null==n?void 0:n.code,"-").concat((null==i?void 0:i.code)||"null","-").concat(e.group_num);o.has(d)||(l.push({type:"group",universe_code:(null==s?void 0:s.code)||"",universe_name:(null==s?void 0:s.name)||"",phylum_code:(null==n?void 0:n.code)||"",phylum_name:(null==n?void 0:n.name)||"",family_code:(null==i?void 0:i.code)||"",family_name:(null==i?void 0:i.name)||"",group_num:e.group_num,group_name:e.name||"",task_num:"",task_title:"",task_status:"",task_priority:"",base_code:"",id:e.id,display_order:0}),o.add(d))}),null==e||e.forEach(e=>{l.push({type:"task",universe_code:e.universe_code||"",universe_name:e.universe_name||"",phylum_code:e.phylum_code||"",phylum_name:e.phylum_name||"",family_code:e.family_code||"",family_name:e.family_name||"",group_num:e.group_num,group_name:e.group_name||"",task_num:e.task_num,task_title:e.title,task_status:e.current_status||e.status,task_priority:e.priority,base_code:e.base_code,id:e.id,display_order:0})});let i=["type","universe_code","universe_name","phylum_code","phylum_name","family_code","family_name","group_num","group_name","task_num","task_title","task_status","task_priority","base_code","id","display_order"],d=[i.join(",")];l.forEach(e=>{let t=i.map(t=>{let a=e[t]||"";return"string"==typeof a&&(a.includes(",")||a.includes('"'))?'"'.concat(a.replace(/"/g,'""'),'"'):a});d.push(t.join(","))});let c=d.join("\n"),u=new Blob([c],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),p=new Date().toISOString().split("T")[0],g="atol-system-export-".concat(p,".csv");m.href=URL.createObjectURL(u),m.download=g,m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),alert("System data exported successfully!\nFile: ".concat(g,"\nRecords: ").concat(l.length))}catch(e){console.error("Export error:",e),alert("Failed to export system data. Please check the console for details.")}}function eq(){ev(!0)}let eV=e=>{let{title:t,color:a,children:s}=e;return(0,r.jsxs)("div",{className:"flex-1 flex flex-col h-full border-r border-gray-300 dark:border-gray-700 last:border-r-0",children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-300 dark:border-gray-700 ".concat(a),children:(0,r.jsx)("h2",{className:"font-mono font-bold text-sm",children:t})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:s})]})};return d?(0,r.jsxs)("div",{className:"min-h-screen bg-[#F8F7F4] dark:bg-[#0A0A0B]",children:[(0,r.jsx)("div",{className:"flex border-b-2 border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900",children:["UNI","PHY","FAM","GRP","TSK"].map(e=>(0,r.jsx)("button",{onClick:()=>m(e),className:"flex-1 p-3 font-mono font-bold text-sm ".concat(u===e?"bg-yellow-100 dark:bg-yellow-900/20 border-b-2 border-yellow-500":"text-gray-500"),children:e},e))}),(0,r.jsxs)("div",{className:"p-4",children:["UNI"===u&&(0,r.jsxs)("div",{className:"space-y-2",children:[p.map(e=>(0,r.jsx)("div",{className:"relative",children:"universe"===eo&&ed===e.id?(0,r.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),(0,r.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Name"})]}),eh&&(0,r.jsx)("div",{className:"text-red-600 text-xs",children:eh}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eM,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Save"}),(0,r.jsx)("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"p-4 rounded-lg font-mono ".concat((null==k?void 0:k.id)===e.id?"bg-yellow-100 dark:bg-yellow-900/20 ring-2 ring-yellow-500":"bg-white dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[(0,r.jsxs)("div",{onClick:()=>j(e),className:"cursor-pointer",children:[(0,r.jsx)("span",{className:"text-xl font-bold",children:e.code}),(0,r.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:e.name}),(0,r.jsx)("div",{className:"mt-1 h-2 bg-gray-200 dark:bg-gray-700 rounded",children:(0,r.jsx)("div",{className:"h-full bg-yellow-500 rounded",style:{width:"60%"}})})]}),(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eF("universe",e.id,e.code,e.name)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eD(e.id,e.name)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),(0,r.jsx)("button",{onClick:()=>A(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]}),"PHY"===u&&k&&(0,r.jsxs)("div",{className:"space-y-2",children:[h.map(e=>(0,r.jsx)("div",{className:"relative",children:"phylum"===eo&&ed===e.id?(0,r.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),(0,r.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Name"})]}),eh&&(0,r.jsx)("div",{className:"text-red-600 text-xs",children:eh}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eM,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Save"}),(0,r.jsx)("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"p-4 rounded-lg font-mono ".concat((null==w?void 0:w.id)===e.id?"bg-yellow-100 dark:bg-yellow-900/20 ring-2 ring-yellow-500":"bg-white dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[(0,r.jsxs)("div",{onClick:()=>C(e),className:"cursor-pointer",children:[(0,r.jsx)("span",{className:"text-xl font-bold",children:e.code}),(0,r.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:e.name})]}),(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eF("phylum",e.id,e.code,e.name)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eP(e.id,e.name)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),(0,r.jsx)("button",{onClick:()=>P(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]}),"FAM"===u&&w&&(0,r.jsxs)("div",{className:"space-y-2",children:[y.map(e=>(0,r.jsx)("div",{className:"relative",children:"family"===eo&&ed===e.id?(0,r.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),(0,r.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Name"})]}),eh&&(0,r.jsx)("div",{className:"text-red-600 text-xs",children:eh}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eM,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Save"}),(0,r.jsx)("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"p-4 rounded-lg font-mono ".concat((null==E?void 0:E.id)===e.id?"bg-yellow-100 dark:bg-yellow-900/20 ring-2 ring-yellow-500":"bg-white dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[(0,r.jsxs)("div",{onClick:()=>S(e),className:"cursor-pointer",children:[(0,r.jsx)("span",{className:"text-xl font-bold",children:e.code}),(0,r.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:e.name})]}),(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eF("family",e.id,e.code,e.name)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eR(e.id,e.name)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),(0,r.jsx)("button",{onClick:()=>L(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]}),"GRP"===u&&w&&(0,r.jsxs)("div",{className:"space-y-2",children:[f.map(e=>(0,r.jsx)("div",{className:"relative",children:"group"===eo&&ed===e.id?(0,r.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,r.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"w-full px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Group name"}),eh&&(0,r.jsx)("div",{className:"text-red-600 text-xs",children:eh}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eM,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Save"}),(0,r.jsx)("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"p-4 rounded-lg font-mono ".concat((null==I?void 0:I.group_num)===e.group_num?"bg-yellow-100 dark:bg-yellow-900/20 ring-2 ring-yellow-500":"bg-white dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[(0,r.jsxs)("div",{onClick:()=>T(e),className:"cursor-pointer",children:[(0,r.jsx)("div",{className:"font-bold",children:String(e.group_num).padStart(2,"0")}),(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.name}),void 0!==e.task_count&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.task_count," tasks"]})]}),(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eF("group",e.id||String(e.group_num),"",e.name)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eL(e.id||"",e.name)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.group_num)),(0,r.jsx)("button",{onClick:()=>U(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]}),"TSK"===u&&I&&(0,r.jsxs)("div",{className:"space-y-2",children:[_.map(e=>(0,r.jsxs)("div",{onClick:()=>window.location.href="/t/".concat(e.code),className:"p-4 bg-white dark:bg-gray-900 rounded-lg font-mono hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer",children:[(0,r.jsx)("div",{className:"font-bold text-lg",children:e.code}),(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.title}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Status: ",e.status," | Priority: ",e.priority," | Group: ",String(e.group_num).padStart(2,"0")]})]},e.id)),M?(0,r.jsxs)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:el,onChange:e=>en(e.target.value.replace(/\D/g,"").slice(0,2)),className:"w-16 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded text-center",maxLength:2,placeholder:"##"}),(0,r.jsx)("input",{type:"text",value:er,onChange:e=>es(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-gray-100 dark:bg-gray-700 rounded",placeholder:"Task title"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eS,className:"px-3 py-1 bg-green-600 text-white rounded text-sm",children:"Create"}),(0,r.jsx)("button",{onClick:()=>{G(!1),es(""),en("")},className:"px-3 py-1 bg-gray-400 text-white rounded text-sm",children:"Cancel"})]})]}):(0,r.jsx)("button",{onClick:()=>G(!0),className:"w-full p-4 border-2 border-dashed border-gray-400 rounded-lg font-mono text-gray-500",children:"+ CREATE NEW"})]})]}),(0,r.jsx)("div",{className:"mt-4 p-3 bg-gray-100 dark:bg-gray-800 border-t-2 border-gray-300 dark:border-gray-700 rounded-b-lg",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-2 sm:gap-4 font-mono",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:eG,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded transition-colors text-sm",children:"[SAVE]"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Export CSV"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:eq,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded transition-colors text-sm",children:"[LOAD]"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Import CSV"})]})]})}),(0,r.jsx)(i,{isOpen:ey,onClose:()=>ev(!1),onImportComplete:()=>{ef(),eb(),e_(),eN(),ek()}})]}):(0,r.jsxs)("div",{className:"h-screen flex flex-col bg-[#F8F7F4] dark:bg-[#0A0A0B]",children:[(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,r.jsxs)(eV,{title:"UNIVERSE",color:"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400",children:[p.map(e=>(0,r.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 ".concat((null==k?void 0:k.id)===e.id?"bg-yellow-100 dark:bg-yellow-900/20":""),children:"universe"===eo&&ed===e.id?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),(0,r.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",placeholder:"Name"})]}),eh&&(0,r.jsx)("div",{className:"text-red-600 text-xs",children:eh}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eM,className:"px-3 py-1 bg-green-600 text-white rounded text-xs",children:"Save"}),(0,r.jsx)("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-xs",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"group relative",children:[(0,r.jsxs)("div",{onClick:()=>j(e),className:"cursor-pointer font-mono",children:[(0,r.jsx)("span",{className:"text-xl font-bold",children:e.code}),(0,r.jsxs)("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["(",e.name,")"]})]}),(0,r.jsxs)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 flex gap-1 transition-opacity",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eF("universe",e.id,e.code,e.name)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eD(e.id,e.name)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]}),(null==k?void 0:k.id)===e.id&&(0,r.jsx)("div",{className:"mt-2 h-1 bg-gradient-to-r from-yellow-400 to-yellow-500"})]})},e.id)),O?(0,r.jsx)(o,{placeholder:"Universe Name",codeMaxLength:1,onCancel:()=>{A(!1),V(""),Y("")},onCreate:async(e,t)=>{await ej(e,t)}}):(0,r.jsx)("button",{onClick:()=>A(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}),(0,r.jsx)(eV,{title:"PHYLUM",color:"bg-orange-100 dark:bg-orange-900/20 text-orange-700 dark:text-orange-400",children:k?(0,r.jsxs)(r.Fragment,{children:[h.map(e=>(0,r.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 ".concat((null==w?void 0:w.id)===e.id?"bg-yellow-100 dark:bg-yellow-900/20":""),children:"phylum"===eo&&ed===e.id?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),(0,r.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",placeholder:"Name"})]}),eh&&(0,r.jsx)("div",{className:"text-red-600 text-xs",children:eh}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eM,className:"px-3 py-1 bg-green-600 text-white rounded text-xs",children:"Save"}),(0,r.jsx)("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-xs",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"group relative",children:[(0,r.jsxs)("div",{onClick:()=>C(e),className:"cursor-pointer font-mono",children:[(0,r.jsx)("span",{className:"text-xl font-bold",children:e.code}),(0,r.jsxs)("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["(",e.name,")"]})]}),(0,r.jsxs)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 flex gap-1 transition-opacity",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eF("phylum",e.id,e.code,e.name)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eP(e.id,e.name)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),D?(0,r.jsx)(o,{placeholder:"Phylum Name",codeMaxLength:1,onCancel:()=>{P(!1),K(""),z("")},onCreate:async(e,t)=>{await ew(e,t)}}):(0,r.jsx)("button",{onClick:()=>P(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}):(0,r.jsx)("div",{className:"p-4 text-gray-400 text-center font-mono",children:"Select a Universe"})}),(0,r.jsx)(eV,{title:"FAMILY",color:"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400",children:w?(0,r.jsxs)(r.Fragment,{children:[y.map(e=>(0,r.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 ".concat((null==E?void 0:E.id)===e.id?"bg-yellow-100 dark:bg-yellow-900/20":""),children:"family"===eo&&ed===e.id?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:ep,onChange:e=>eg(e.target.value.toUpperCase().slice(0,1)),className:"w-12 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded text-center",maxLength:1,placeholder:"C"}),(0,r.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"flex-1 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",placeholder:"Name"})]}),eh&&(0,r.jsx)("div",{className:"text-red-600 text-xs",children:eh}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eM,className:"px-3 py-1 bg-green-600 text-white rounded text-xs",children:"Save"}),(0,r.jsx)("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-xs",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"group relative",children:[(0,r.jsxs)("div",{onClick:()=>S(e),className:"cursor-pointer font-mono",children:[(0,r.jsx)("span",{className:"text-lg font-bold",children:e.code}),(0,r.jsxs)("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["(",e.name,")"]})]}),(0,r.jsxs)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 flex gap-1 transition-opacity",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eF("family",e.id,e.code,e.name)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eR(e.id,e.name)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]})]})},e.id)),R?(0,r.jsx)(o,{placeholder:"Family Name",codeMaxLength:1,onCancel:()=>{L(!1),J(""),Q("")},onCreate:async(e,t)=>{await eC(e,t)}}):(0,r.jsx)("button",{onClick:()=>L(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}):(0,r.jsx)("div",{className:"p-4 text-gray-400 text-center font-mono",children:"Select a Phylum"})}),(0,r.jsx)(eV,{title:"GROUP",color:"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400",children:w?(0,r.jsxs)(r.Fragment,{children:[f.map(e=>(0,r.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800 ".concat((null==I?void 0:I.group_num)===e.group_num?"bg-yellow-100 dark:bg-yellow-900/20":""),children:"group"===eo&&ed===e.id?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("input",{type:"text",value:eu,onChange:e=>em(e.target.value),className:"w-full px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",placeholder:"Group name"}),eh&&(0,r.jsx)("div",{className:"text-red-600 text-xs",children:eh}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eM,className:"px-3 py-1 bg-green-600 text-white rounded text-xs",children:"Save"}),(0,r.jsx)("button",{onClick:eU,className:"px-3 py-1 bg-gray-400 text-white rounded text-xs",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"group relative",children:[(0,r.jsxs)("div",{onClick:()=>T(e),className:"cursor-pointer font-mono",children:[(0,r.jsx)("span",{className:"font-bold",children:String(e.group_num).padStart(2,"0")}),(0,r.jsxs)("span",{className:"ml-2 text-sm",children:["- ",e.name]})]}),(0,r.jsxs)("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 flex gap-1 transition-opacity",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eF("group",e.id||String(e.group_num),"",e.name)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:"∴"}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),eL(e.id||"",e.name)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:"\xd7"})]}),void 0!==e.task_count&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.task_count," tasks"]})]})},"".concat(e.group_num))),F?(0,r.jsx)(o,{placeholder:"Group Name",codeMaxLength:2,codeType:"numeric",codePlaceholder:"01",onCancel:()=>{U(!1),ea(""),ee("")},onCreate:async(e,t)=>{await eE(e,t)}}):(0,r.jsx)("button",{onClick:()=>U(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}):(0,r.jsx)("div",{className:"p-4 text-gray-400 text-center font-mono",children:"Select a Phylum"})}),(0,r.jsx)(eV,{title:"TASK",color:"bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400",children:I?(0,r.jsxs)(r.Fragment,{children:[_.map(t=>(0,r.jsx)("div",{onClick:()=>{var a;return e.push("/t/".concat(null===(a=t.base_code)||void 0===a?void 0:a.toLowerCase()))},className:"p-4 cursor-pointer border-b border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-800",children:(0,r.jsxs)("div",{className:"font-mono",children:[(0,r.jsxs)("div",{className:"font-bold",children:[String(t.task_num).padStart(2,"0")," ..."]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:['"',t.title,'"']}),t.current_status&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Status: ",t.current_status_name]})]})},t.id)),M?(0,r.jsxs)("div",{className:"p-4 bg-gray-100 dark:bg-gray-800",children:[(0,r.jsx)("input",{type:"text",placeholder:"Task Number",value:el,onChange:e=>en(e.target.value.replace(/\D/g,"").slice(0,2)),className:"w-full mb-2 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded",maxLength:2}),(0,r.jsx)("input",{type:"text",placeholder:"Task Title",value:er,onChange:e=>es(e.target.value),className:"w-full mb-2 px-2 py-1 font-mono bg-white dark:bg-gray-700 rounded"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:eS,className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Create"}),(0,r.jsx)("button",{onClick:()=>{G(!1),es(""),en("")},className:"px-3 py-1 bg-gray-400 text-white rounded",children:"Cancel"})]})]}):(0,r.jsx)("button",{onClick:()=>G(!0),className:"w-full p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-800 font-mono text-gray-500",children:"+ CREATE"})]}):(0,r.jsx)("div",{className:"p-4 text-gray-400 text-center font-mono",children:"Select a Group"})})]}),(0,r.jsx)("div",{className:"mt-4 p-3 bg-gray-100 dark:bg-gray-800 border-t-2 border-gray-300 dark:border-gray-700 rounded-b-lg",children:(0,r.jsxs)("div",{className:"flex justify-center items-center gap-4 font-mono",children:[(0,r.jsx)("button",{onClick:eG,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded transition-colors",children:"[SAVE]"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Export system data to CSV"}),(0,r.jsx)("div",{className:"w-px h-6 bg-gray-400"}),(0,r.jsx)("button",{onClick:eq,className:"px-6 py-2 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded transition-colors",children:"[LOAD]"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Import system data from CSV"})]})}),(0,r.jsx)(i,{isOpen:ey,onClose:()=>ev(!1),onImportComplete:()=>{ef(),eb(),e_(),eN(),ek()}})]})}},5922:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});let r=(0,a(7887).eI)("https://ofiindxmfiptivijhbdi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9maWluZHhtZmlwdGl2aWpoYmRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzOTU4MjEsImV4cCI6MjA3Mzk3MTgyMX0.P9Qmhha1EL7X0uQ8CiUF6LXWqBCQt1pJwg3cmcHkfR0")},7907:function(e,t,a){"use strict";var r=a(5313);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[887,971,69,744],function(){return e(e.s=5196)}),_N_E=e.O()}]);